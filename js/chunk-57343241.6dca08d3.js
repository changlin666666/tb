(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-57343241"],{"0f85":function(e,t,l){"use strict";l("9209")},"188c":function(e,t,l){},"1a48":function(e,t,l){},"3fc8":function(e,t,l){"use strict";l("1a48")},4152:function(e,t,l){"use strict";l.d(t,"c",(function(){return o})),l.d(t,"b",(function(){return a}));var n=l("7bc1"),o=function(e){return n["a"].post("/form/page",e)},a=function(e){return n["a"].get("/form/struct",e)};t["a"]={groupList:function(e){return n["a"].post("/category/page",e)},delGroup:function(e){return n["a"].delete("/category/delete",e)},addGroup:function(e){return n["a"].post("/category/create",e)},saveGroup:function(e){return n["a"].post("/category/update",e)},detailGroup:function(e){return n["a"].get("/category/select",e)},list:function(e){return n["a"].post("/form/page",e)},add:function(e){return n["a"].post("/form/create",e)},del:function(e){return n["a"].delete("/form/delete",e)},detail:function(e){return n["a"].get("/form/select",e)},save:function(e){return n["a"].post("/form/update",e)},getStruct:function(e){return n["a"].get("/form/struct",e)},saveStruct:function(e){return n["a"].post("/form/struct",e)},tableConfig:function(e){return n["a"].post("/table/page",e)},saveTable:function(e){return n["a"].post("/table/update",e)}}},"42a5":function(e,t,l){},4568:function(e,t,l){"use strict";l("d4ec"),l("ade3")},"58e1":function(e,t,l){},"66e3":function(e,t,l){"use strict";l("58e1")},7690:function(e,t,l){"use strict";l.r(t);var n=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("el-dialog",{attrs:{visible:e.visible,title:e.title,width:e.width,fullscreen:""},on:{"update:visible":function(t){e.visible=t},close:function(t){e.visible=!1}}},[l("myTable",{ref:"tableDesigner",attrs:{dictList:e.dictList,formList:e.formList,formId:e.formId,fields:e.fields}}),l("span",{attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取 消")]),l("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"},{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)],1)},o=[],a=l("1da1"),i=(l("96cf"),l("b0c0"),l("4152")),s=l("c095"),r={components:{myTable:s["a"]},props:{width:{type:String,default:"100%"},treeData:{type:Array,default:function(){return[]}}},data:function(){return{visible:!1,method:"",id:"",dictList:[],formList:[],title:"表格设计",formId:"",fields:[],loading:!1,btnSaveIsLoading:!1}},methods:{init:function(e){var t=this;this.loading=!1,this.visible=!0,this.$nextTick(Object(a["a"])(regeneratorRuntime.mark((function l(){var n,o,a,s,r;return regeneratorRuntime.wrap((function(l){while(1)switch(l.prev=l.next){case 0:return t.formId=e,l.next=3,i["a"].tableConfig({formId:e});case 3:return n=l.sent,o=n.data,0==o.code&&o.data.records.length>0?(t.id=o.data.records[0].id,a=JSON.parse(o.data.records[0].structContent),a.name=o.data.records[0].tableTitle,t.$refs.tableDesigner.setJSON(a)):t.$refs.tableDesigner.setJSON({columns:[]}),l.next=8,i["a"].getStruct({id:e});case 8:s=l.sent,r=s.data,0==r.code&&r.data.structContent&&"null"!==r.data.structContent&&(t.fields=JSON.parse(r.data.structContent).list);case 11:case"end":return l.stop()}}),l)}))))},submit:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var l,n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,l=e.$refs.tableDesigner.getData(),t.next=5,i["a"].saveTable({tableId:e.id,structContent:JSON.stringify(l)});case 5:if(n=t.sent,o=n.data,0==o.code){t.next=9;break}return t.abrupt("return",e.$message.error("表格设计操作失败！"));case 9:e.$message.success("表格设计操作成功！"),e.loading=!1,e.visible=!1,t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](0),e.$message.error(t.t0);case 17:case"end":return t.stop()}}),t,null,[[0,14]])})))()}}},c=r,u=(l("3fc8"),l("2877")),d=Object(u["a"])(c,n,o,!1,null,"73420758",null);t["default"]=d.exports},"7a88":function(e,t,l){"use strict";l("42a5")},9209:function(e,t,l){},c095:function(e,t,l){"use strict";var n=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("el-row",[l("el-col",{attrs:{span:12}},[e._v(" 表单名称："+e._s(e.objJSON.name)+" ")]),l("el-col",{attrs:{span:12}},[l("MenuBar",{staticStyle:{float:"right"},attrs:{designedJSON:e.objJSON,fieldConfig:e.fieldConfig,formList:e.formList,minColumnWidth:e.minColumnWidth},on:{"update:designedJSON":function(t){e.objJSON=t},"update:designed-j-s-o-n":function(t){e.objJSON=t}}})],1)],1),l("el-table",{ref:"table",staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{stripe:"",fit:"",data:e.objJSON.columns,"row-key":function(e){return e.id||e.prop},border:""}},e._l(e.fieldConfig,(function(t){return l("el-table-column",{key:t.name,attrs:{"header-align":"center",align:"center",label:t.name,"min-width":t.headStyle},scopedSlots:e._u([{key:"default",fn:function(n){return["i"===t.is?[l("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"拖拽可以排序哦~",placement:"left"}},[l("i",{staticClass:"el-icon-sort",staticStyle:{color:"blue",cursor:"pointer"}})])]:e._e(),"field"===t.is?l("el-select",{attrs:{size:"small",placeholder:t.field,disabled:"_action"===n.row.prop},model:{value:n.row[t.field],callback:function(l){e.$set(n.row,t.field,l)},expression:"scope.row[column.field]"}},e._l(e.fields,(function(e){return l("el-option",{key:e.model,attrs:{label:e.model,value:e.model}})})),1):"input"===t.is?l("el-input",{class:{notDefaultWidth:"minWidth"===t.field&&140!==n.row[t.field]},attrs:{placeholder:t.field,size:"small"},model:{value:n.row[t.field],callback:function(l){e.$set(n.row,t.field,l)},expression:"scope.row[column.field]"}}):"select"===t.is?l("el-select",{attrs:{size:"small",clearable:"",placeholder:t.field},model:{value:n.row[t.field],callback:function(l){e.$set(n.row,t.field,l)},expression:"scope.row[column.field]"}},e._l(t.list,(function(e){return l("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})})),1):"switch"===t.is?l("el-switch",{attrs:{size:"small"},model:{value:n.row[t.field],callback:function(l){e.$set(n.row,t.field,l)},expression:"scope.row[column.field]"}}):e._e(),"link"==t.field?[l("el-popover",{attrs:{placement:"bottom-start",width:"400",trigger:"click"}},[l("el-form",{attrs:{"label-position":"left","label-width":"80px",size:"mini"}},[l("el-form-item",{attrs:{label:"跳转方式"}},[l("el-select",{model:{value:n.row["link_type"],callback:function(t){e.$set(n.row,"link_type",t)},expression:"scope.row['link_type']"}},e._l(e.linkTypes,(function(e,t){return l("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),l("el-form-item",{attrs:{label:"跳转链接"}},[l("el-input",{attrs:{type:"textarea",rows:"5",placeholder:"外链带上http协议"},model:{value:n.row["link_url"],callback:function(t){e.$set(n.row,"link_url",t)},expression:"scope.row['link_url']"}})],1)],1),l("el-button",{staticStyle:{"margin-left":"4px"},attrs:{slot:"reference",icon:"el-icon-s-tools",type:"text"},slot:"reference"})],1)]:e._e(),"action"===t.is?[l("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除当前行",placement:"left"}},[l("i",{staticClass:"el-icon el-icon-delete",staticStyle:{color:"red",cursor:"pointer"},on:{click:function(t){return e.removeColumn(n.$index)}}})])]:e._e()]}}],null,!0)})})),1)],1)},o=[],a=(l("a434"),l("4568"),l("aa47")),i=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("el-container",[l("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-tickets"},on:{click:e.handleGenerateJson}},[e._v("生成JSON")]),l("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.addColumn("addColumn")}}},[e._v("添加列")]),l("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.addColumn("addColumnx5")}}},[e._v("添加5列")]),l("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.addColumn("addActionColumn")}}},[e._v("添加操作列")]),e.formList.length>0?l("el-dropdown",{on:{command:e.autoSet}},[l("el-button",{attrs:{size:"small"}},[e._v("快捷设置"),l("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),l("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[l("el-dropdown-item",{attrs:{command:"generateTableByForm"}},[e._v(" [请先设置表单]根据表单生成表格 ")]),l("el-dropdown-item",{attrs:{command:"autoSetSearchOption"}},[e._v(" [请先设置表单]分析表单配置以设置表格高级搜索options ")])],1)],1):e._e(),e.formList.length>0?l("el-select",{attrs:{size:"small",placeholder:"请选择表单",filterable:""},model:{value:e.selectedForm,callback:function(t){e.selectedForm=t},expression:"selectedForm"}},e._l(e.formList,(function(e,t){return l("el-option",{key:t,attrs:{label:e.tableName,value:e.tableName}})})),1):e._e(),l("CusDialog",{ref:"jsonPreview",attrs:{visible:e.jsonVisible,width:"800px",form:""},on:{"on-close":function(t){e.jsonVisible=!1}}},[l("div",{staticStyle:{height:"727px",width:"100%"},attrs:{id:"jsoneditor"}},[e._v(" "+e._s(e.jsonTemplate)+" ")]),l("template",{slot:"action"},[l("el-button",{staticClass:"json-btn",attrs:{type:"primary","data-clipboard-text":e.jsonCopyValue}},[e._v("复制JSON")])],1)],2)],1)},s=[],r=l("b85c"),c=(l("a9e3"),l("159b"),l("2532"),l("b64b"),l("caad"),l("b0c0"),l("a15b"),l("ac1f"),l("1276"),l("69d8")),u=l("b311"),d=l.n(u),p={name:"MenuBar",data:function(){return{selectedForm:null,jsonVisible:!1,jsonCopyValue:"",jsonClipboard:null,jsonTemplate:""}},props:{designedJSON:{type:Object,default:function(){return{columns:[]}}},minColumnWidth:{type:Number,default:140},formList:{type:Array,default:function(){return[]}}},methods:{handleGenerateJson:function(){var e=this;this.jsonVisible=!0,this.jsonTemplate=JSON.stringify(this.designedJSON,null,2),this.$nextTick((function(){var t=window.ace.edit("jsoneditor");t.session.setMode("ace/mode/json"),e.jsonClipboard||(e.jsonClipboard=new d.a(".json-btn"),e.jsonClipboard.on("success",(function(t){e.$message.success("复制成功")}))),e.jsonCopyValue=JSON.stringify(e.designedJSON)}))},autoSetSearchOption:function(){var e=this;null==this.selectedForm&&this.$message({type:"info",message:"请先选择表单"}),this.$PROCRUD.getFormDetail(this.selectedForm).then((function(t){if(null!==t.data){var l=JSON.parse(t.data.formJson),n=[];l.list.forEach((function(t){t.columns.forEach((function(t){var l=t.list[0];if(l&&"date,select".includes(l.type)){var o=["type","format","width","placeholder","remote","remoteFunc","dictType","props","options"],a={};Object.keys(l.options).forEach((function(e){o.includes(e)&&(a[e]=l.options[e])})),a.type=l.type;var i,s=Object(r["a"])(e.designedJSON.columns);try{for(s.s();!(i=s.n()).done;){var c=i.value;c.prop!=="".concat(l.model,"dict")&&c.prop!==l.model||e.$set(c,"option",a)}}catch(u){s.e(u)}finally{s.f()}n.push(l.name)}}))})),e.$notify({title:"".concat(n.length,"个字段已完成高级查询设置"),message:"".concat(n.join(","),"已添加option"),duration:5e3})}else e.$message({type:"info",message:"未找到动态表单json，只能自己写表格了"})}))},addColumn:function(e){switch(e){case"addColumn":this.designedJSON.columns.push({id:Math.random(),prop:"",label:"",align:"center",headerAlign:"center",showOverflowTooltip:!0,minWidth:this.minColumnWidth,sortable:"custom",searchable:!0,hasChildren:!0});break;case"addColumnx5":for(var t=0;t<5;t+=1)this.designedJSON.columns.push({id:Math.random(),prop:"",label:"",align:"center",headerAlign:"center",showOverflowTooltip:!0,minWidth:this.minColumnWidth,sortable:"custom",searchable:!0});break;case"addActionColumn":this.designedJSON.columns.push({id:Math.random(),prop:"_action",label:"操作",minWidth:180,align:"center",headerAlign:"center",slotName:"actionColumn",fixed:"right",sortable:"false",searchable:!1});break;default:break}},autoSet:function(e){var t=this;switch(e){case"autoSetSearchOption":this.autoSetSearchOption();break;case"generateTableByForm":if(null==this.selectedForm){this.$message({type:"info",message:"请先选择表单"});break}this.$PROCRUD.getFormDetail(this.selectedForm).then((function(e){if(null!==e.data){var l,n=JSON.parse(e.data.formJson),o=Object(r["a"])(n.list);try{for(o.s();!(l=o.n()).done;){var a,i=l.value,s=Object(r["a"])(i.columns);try{for(s.s();!(a=s.n()).done;){var c=a.value,u=c.list[0].model;t.designedJSON.columns.push({id:Math.random(),prop:u.split("_")[1]||u.split("_")[0],label:c.list[0].name,minWidth:t.minColumnWidth,align:"center",headerAlign:"center",showOverflowTooltip:!0,sortable:null!=c.list[0].sortable?c.list[0].sortable:"custom",slotName:"",searchable:!0})}}catch(d){s.e(d)}finally{s.f()}}}catch(d){o.e(d)}finally{o.f()}t.designedJSON.columns.push({prop:"",label:"操作",minWidth:180,align:"center",headerAlign:"center",slotName:"actionColumn",fixed:"right",sortable:"false",searchable:!1})}else t.$message({type:"info",message:"未找到动态表单json，只能自己写表格了"})})),this.autoSetSearchOption();break;default:break}},removeColumn:function(e){this.designedJSON.columns.splice(e,1)}},components:{CusDialog:c["a"]},watch:{designedJSON:function(e){this.$emit("update:designedJSON",e)}}},f=p,m=(l("e218"),l("2877")),b=Object(m["a"])(f,i,s,!1,null,"78a1b78e",null),h=b.exports,v=[{name:"#",is:"i",show:!0,bodyStyle:"el-icon-sort",tootip:"拖拽可以排序哦~",headStyle:"30"},{name:"字段",field:"prop",is:"field",headStyle:"100",show:!0},{name:"列名",field:"label",is:"input",headStyle:"100",show:!0},{name:"最小宽",field:"minWidth",is:"input",headStyle:"60",tootip:"加粗黑色表示非默认宽度",show:!0},{name:"表格对齐",field:"align",is:"select",headStyle:"70",list:[{label:"靠左",value:"left"},{label:"居中",value:"center"},{label:"靠右",value:"right"},{label:"默认对齐",value:void 0}],show:!0},{name:"表头对齐",field:"headerAlign",is:"select",headStyle:"70",list:[{label:"靠左",value:"left"},{label:"居中",value:"center"},{label:"靠右",value:"right"},{label:"默认对齐",value:void 0}],show:!0},{name:"固定方式",field:"fixed",is:"select",headStyle:"70",list:[{label:"靠左",value:"left"},{label:"靠右",value:"right"},{label:"不固定",value:!1}],show:!0},{name:"溢出隐藏",field:"showOverflowTooltip",headStyle:"50",is:"switch",show:!0},{name:"排序方式",field:"sortable",is:"select",headStyle:"100",list:[{label:"不排序",value:"false"},{label:"服务端排序",value:"custom"}],show:!0},{name:"是否检索",field:"searchable",headStyle:"50",is:"switch",tootip:"是否在表格顶部高级查询区域显示",show:!0},{name:"是否跳转",field:"link",is:"switch",headStyle:"50",url:"",type:"",show:!0},{name:"插槽",field:"slotName",is:"select",headStyle:"150",show:!0,list:[{label:"操作栏(actionColumn)",value:"actionColumn"},{label:"自定义按钮(btnCustom)",value:"btnCustom"}]},{name:"操作",show:!0,is:"action",headStyle:"40"}],g=function(){var e=this,t=e.$createElement,l=e._self._c||t;return e.localOption?l("div",[l("div",{staticClass:"detailTitleBar"},[l("h2",[e._v("下拉菜单数据来源")]),l("el-radio-group",{staticStyle:{margin:"3px 0 0 0"},attrs:{size:"mini"},model:{value:e.localOption.remote,callback:function(t){e.$set(e.localOption,"remote",t)},expression:"localOption.remote"}},[e.dictList.length>0?l("el-radio-button",{attrs:{label:"dict"}},[e._v("字典")]):e._e(),l("el-radio-button",{attrs:{label:"static"}},[e._v("静态")]),l("el-radio-button",{attrs:{label:"custom"}},[e._v("自定义")])],1)],1),"dict"==e.localOption.remote?[l("el-select",{attrs:{placeholder:"字典类型",filterable:""},model:{value:e.localOption.dictType,callback:function(t){e.$set(e.localOption,"dictType",t)},expression:"localOption.dictType"}},e._l(e.dictList,(function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]:"custom"==e.localOption.remote?[l("div",[l("el-input",{staticStyle:{margin:"0 0 8px 0"},model:{value:e.localOption.remoteFunc,callback:function(t){e.$set(e.localOption,"remoteFunc",t)},expression:"localOption.remoteFunc"}},[l("template",{slot:"prepend"},[e._v("远端方法")])],2),l("el-input",{staticStyle:{margin:"0 0 8px 0"},model:{value:e.localOption.props.value,callback:function(t){e.$set(e.localOption.props,"value",t)},expression:"localOption.props.value"}},[l("template",{slot:"prepend"},[e._v("值")])],2),l("el-input",{staticStyle:{margin:"0 0 8px 0"},model:{value:e.localOption.props.label,callback:function(t){e.$set(e.localOption.props,"label",t)},expression:"localOption.props.label"}},[l("template",{slot:"prepend"},[e._v("标签")])],2)],1)]:[l("el-button",{attrs:{type:"primary",plain:""},on:{click:e.btnAddOption}},[e._v("添加选项")]),"radio"==e.localOption.type||"select"==e.localOption.type&&!e.localOption.multiple?[l("Draggable",{staticStyle:{padding:"0","list-style":"none"},attrs:{tag:"ul",list:e.localOption.options,options:{group:{name:"options"},ghostClass:"ghost",handle:".drag-item"}}},e._l(e.localOption.options,(function(t,n){return l("li",{key:n,staticStyle:{margin:"10px 0"}},[l("el-input",{style:{width:"120px",marginRight:"10px"},model:{value:t.value,callback:function(l){e.$set(t,"value",l)},expression:"item.value"}}),l("el-input",{staticStyle:{width:"100px","margin-right":"'10px'"},model:{value:t.label,callback:function(l){e.$set(t,"label",l)},expression:"item.label"}}),l("i",{staticClass:"drag-item",staticStyle:{"font-size":"16px",margin:"0 5px",cursor:"move"}},[l("Icon",{attrs:{name:"bars"}})],1),l("el-button",{staticStyle:{padding:"4px","margin-left":"5px"},attrs:{circle:"",plain:"",type:"danger",size:"mini",icon:"el-icon-minus"},on:{click:function(t){return e.btnRemoveOption(n)}}})],1)})),0)]:e._e()]],2):e._e()},y=[],O=(l("b7a3"),l("b76a")),w=l.n(O),S=l("0874"),k={components:{Draggable:w.a,Icon:S["a"]},data:function(){return{localOption:null}},props:{sourceOption:{type:Object,default:function(){return{}}},dictList:{type:Array,default:function(){return[]}}},created:function(){this.localOption=this.sourceOption},methods:{btnAddOption:function(){null==this.localOption.options&&this.$set(this.localOption,"options",[]),this.localOption.options.push({value:"value",label:"label"})},btnRemoveOption:function(e){"grid"===this.localOption.type?this.localOption.columns.splice(e,1):this.localOption.options.splice(e,1)}},watch:{localOption:function(e){this.$emit("update:localOption",e)}}},C=k,_=(l("66e3"),Object(m["a"])(C,g,y,!1,null,"7782da3e",null)),x=_.exports,j={name:"TableDesigner",components:{MenuBar:h,SelectConfig:x},props:{allTables:{type:Array,default:null},formList:{type:Array,default:function(){return[]}},dictList:{type:Array,default:function(){return[]}},formId:{type:String,default:""},fields:{type:Array,default:function(){return[]}}},data:function(){return{formValues:{},objJSON:{columns:[]},linkTypes:[{label:"新开页面跳转",value:"_blank"},{label:"当前页面跳转",value:"_self"},{label:"系统内页面跳转",value:"router"}],fieldConfig:v,btnSaveIsLoading:!1,minColumnWidth:140,entity:{}}},mounted:function(){this.rowDrop()},methods:{rowDrop:function(){var e=this.$refs.table.$el.querySelector(".el-table__body-wrapper tbody"),t=this;a["default"].create(e,{onEnd:function(e){var l=e.newIndex,n=e.oldIndex,o=t.objJSON.columns.splice(n,1)[0];t.objJSON.columns.splice(l,0,o)}})},removeColumn:function(e){this.objJSON.columns.splice(e,1)},addOptionToColumn:function(e){this.$set(this.objJSON.columns[e],"option",{remote:"static",remoteFunc:"",type:"select",props:{value:"",label:""}})},getData:function(){return this.objJSON},setJSON:function(e){this.objJSON=e}}},N=j,J=(l("0f85"),l("7a88"),Object(m["a"])(N,n,o,!1,null,"a35bbb72",null));t["a"]=J.exports},d4ec:function(e,t,l){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}l.d(t,"a",(function(){return n}))},e218:function(e,t,l){"use strict";l("188c")}}]);