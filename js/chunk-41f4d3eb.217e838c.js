(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-41f4d3eb","chunk-20660a86","chunk-38e6a655","chunk-13ad6fd8"],{2803:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{fullscreen:"",title:"执行历史",visible:e.dialogVisible,width:"80%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("div",{staticClass:"mainview"},[r("kr-table",{ref:"table",attrs:{columns:e.columns,rows:e.tableData,fetchFunc:e.getList,searchParams:e.searchParams},on:{"selection-change":e.handleSelectionChange}})],1)])},a=[],i=(r("ac1f"),r("5319"),r("4de4"),r("7dca")),s={computed:{getList:function(){return i["a"].history}},data:function(){this.$createElement;var e=this;return{dialogVisible:!1,tableData:[],selection:[],columns:[{prop:"scriptContent",label:"脚本内容"},{label:"执行开始时间",render:function(e,t,r){return e("span",[new Date(parseInt(t.startTime)).toLocaleString().replace(/:\d{1,2}$/," ")])}},{prop:"spendTime",label:"耗时"},{prop:"result",label:"结果"},{label:"是否成功",render:function(e,t,r){return e("span",[0==t.success?"成功":"失败"])}},{label:"任务类型",render:function(t,r,n){return t("span",[e.getTypeText(r.jobType)])}},{prop:"description",label:"描述"}],typeList:[{code:"0",value:"java方法"},{code:"1",value:"SQL脚本"},{code:"2",value:"SQL脚本文件"},{code:"3",value:"LINUX脚本"},{code:"4",value:"LINUX脚本文件"},{code:"5",value:"WINDOWS脚本"},{code:"6",value:"WINDOWS脚本文件"},{code:"7",value:"JS脚本"},{code:"8",value:"JS脚本文件"},{code:"9",value:"python脚本"},{code:"10",value:"python脚本文件"}],searchParams:{}}},methods:{showInfo:function(e){var t=this;this.searchParams={id:e.id},this.dialogVisible=!0,this.$nextTick((function(){t.$refs.table.init()}))},handleSelectionChange:function(e){this.selection=e},getTypeText:function(e){return this.typeList.filter((function(t){return t.code==e}))[0].value}}},o=s,c=(r("7ec2"),r("2877")),l=Object(c["a"])(o,n,a,!1,null,"34f87314",null);t["default"]=l.exports},4112:function(e,t,r){},"5f87":function(e,t,r){"use strict";r("4112")},6512:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,width:"60%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{ref:"form",attrs:{model:e.form,"label-width":"140px",rules:e.rules}},[r("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"请填写任务名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),r("el-form-item",{attrs:{label:"任务类型",prop:"jobType"}},[r("el-select",{staticClass:"wid100",attrs:{placeholder:"请选择任务类型"},model:{value:e.form.jobType,callback:function(t){e.$set(e.form,"jobType",t)},expression:"form.jobType"}},e._l(e.typeList,(function(e){return r("el-option",{key:e.code,attrs:{label:e.value,value:e.code}})})),1)],1),e.form.jobType%2==0?r("el-form-item",{attrs:{label:"任务路径",prop:"jobPath"}},[r("el-input",{attrs:{placeholder:"类全名或者脚本文件路径"},model:{value:e.form.jobPath,callback:function(t){e.$set(e.form,"jobPath",t)},expression:"form.jobPath"}})],1):r("el-form-item",{attrs:{label:"脚本内容",prop:"scriptContent"}},[r("el-input",{attrs:{placeholder:"请填写脚本内容"},model:{value:e.form.scriptContent,callback:function(t){e.$set(e.form,"scriptContent",t)},expression:"form.scriptContent"}})],1),r("el-form-item",{attrs:{label:"任务组",prop:"group"}},[r("el-input",{attrs:{placeholder:"请填写任务组"},model:{value:e.form.group,callback:function(t){e.$set(e.form,"group",t)},expression:"form.group"}})],1),r("el-form-item",{attrs:{label:"定时规则类型",prop:"triggerType"}},[r("el-select",{staticClass:"wid100",attrs:{placeholder:"请选择定时规则类型"},model:{value:e.form.triggerType,callback:function(t){e.$set(e.form,"triggerType",t)},expression:"form.triggerType"}},[r("el-option",{attrs:{label:"cron表达式",value:"0"}}),r("el-option",{attrs:{label:"固定间隔和次数",value:"1"}})],1)],1),"0"===e.form.triggerType?r("el-form-item",{attrs:{label:"corn表达式",prop:"cronExpression"}},[r("el-input",{staticClass:"dialogcron",model:{value:e.form.cronExpression,callback:function(t){e.$set(e.form,"cronExpression",t)},expression:"form.cronExpression"}}),r("el-button",{on:{click:e.clickCron}},[e._v("设置")])],1):e._e(),1==e.form.triggerType?r("el-form-item",{staticClass:"half",attrs:{label:"重复次数",prop:"repeatCount"}},[r("el-input",{model:{value:e.form.repeatCount,callback:function(t){e.$set(e.form,"repeatCount",e._n(t))},expression:"form.repeatCount"}})],1):e._e(),1==e.form.triggerType?r("el-form-item",{staticClass:"half",attrs:{label:"重复间隔毫秒数",prop:"repeatInterval"}},[r("el-input",{model:{value:e.form.repeatInterval,callback:function(t){e.$set(e.form,"repeatInterval",e._n(t))},expression:"form.repeatInterval"}})],1):e._e(),r("el-form-item",{attrs:{label:"描述",prop:"description"}},[r("el-input",{attrs:{placeholder:"请填写任务描述"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.clickSub}},[e._v("确 定")])],1),r("cron",{ref:"cron",on:{onFinish:e.oncronFinish}})],1)},a=[],i=r("1da1"),s=(r("96cf"),r("8771")),o=r("7dca"),c=(r("f477"),{data:function(){var e=this,t=function(e,t,r){t<6e4?r(new Error("必须大于一分钟")):r()},r=function(t,r,n){e.form.jobType%2!=0||r?n():n(new Error("请填写任务路径"))},n=function(t,r,n){e.form.jobType%2==0||r?n():n(new Error("请填写脚本内容"))};return{form:{name:"",cronExpression:"",description:"",group:"",scriptContent:"",triggerType:"",repeatCount:"",repeatInterval:"",jobType:"",jobPath:""},dialogVisible:!1,title:"",type:"",rules:{name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],jobType:[{required:!0,message:"请选择任务类型",trigger:"change"}],group:[{required:!0,message:"请填写任务组",trigger:"blur"}],triggerType:[{required:!0,message:"请选择定时规则类型",trigger:"change"}],repeatCount:[{required:!0,message:"请输入重复次数",trigger:"blur"},{type:"integer",message:"请输入数字",trigger:"blur"}],repeatInterval:[{type:"number",message:"请输入数字",trigger:"blur"},{validator:t,trigger:"blur"}],jobPath:[{validator:r,trigger:"blur"}],scriptContent:[{validator:n,trigger:"blur"}]}}},components:{cron:s["default"]},computed:{typeList:function(){return[{code:"0",value:"java方法"},{code:"1",value:"SQL脚本"},{code:"2",value:"SQL脚本文件"},{code:"3",value:"LINUX脚本"},{code:"4",value:"LINUX脚本文件"},{code:"5",value:"WINDOWS脚本"},{code:"6",value:"WINDOWS脚本文件"},{code:"7",value:"JS脚本"},{code:"8",value:"JS脚本文件"},{code:"9",value:"python脚本"},{code:"10",value:"python脚本文件"}]}},methods:{initForm:function(e,t){var r=this;this.type=e,this.title="add"==e?"新增":"编辑",this.dialogVisible=!0,this.$nextTick((function(){r.$refs.form.resetFields(),"add"!=e&&(r.form=JSON.parse(JSON.stringify(t)))}))},clickCron:function(){"add"==this.type?this.$refs.cron.init("add"):this.$refs.cron.init("edit",this.form.cronExpression)},oncronFinish:function(e){this.form.cronExpression=e},clickSub:function(){var e=this;try{this.$refs.form.validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(r){var n,a,i,s,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=20;break}if(n=JSON.parse(JSON.stringify(e.form)),1==n.triggerType&&delete n.cronExpression,0!==n.jobType){t.next=10;break}return t.next=6,o["a"].existsClass({className:n.jobPath});case 6:if(a=t.sent,i=a.data,0==i.code){t.next=10;break}return t.abrupt("return");case 10:if(!(n.jobType>0&&n.jobType%2==0)){t.next=17;break}return t.next=13,o["a"].existsJobPath({jobPath:n.jobPath});case 13:if(s=t.sent,c=s.data,0==c.code){t.next=17;break}return t.abrupt("return");case 17:"add"==e.type?e.postAdd(n):e.postEdit(n),t.next=21;break;case 20:return t.abrupt("return",!1);case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}catch(t){this.$message.error(t)}},postAdd:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.status="0",r.next=3,o["a"].add(e);case 3:if(n=r.sent,a=n.data,0==a.code){r.next=8;break}return t.$message.error(a.msg),r.abrupt("return");case 8:t.$message.success(a.data),t.$parent.$refs.table.init(),t.dialogVisible=!1;case 11:case"end":return r.stop()}}),r)})))()},postEdit:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.nearTime=null,r.next=3,o["a"].edit(e);case 3:if(n=r.sent,a=n.data,0==a.code){r.next=8;break}return t.$message.error(a.msg),r.abrupt("return");case 8:t.$message.success(a.data),t.$parent.$refs.table.init(),t.dialogVisible=!1;case 11:case"end":return r.stop()}}),r)})))()}}}),l=c,u=(r("5f87"),r("2877")),p=Object(u["a"])(l,n,a,!1,null,"62bb1474",null);t["default"]=p.exports},"7dca":function(e,t,r){"use strict";var n=r("7bc1");t["a"]={list:function(e){return n["a"].post("/task/list",e)},add:function(e){return n["a"].post("/task/add",e)},edit:function(e){return n["a"].post("/task/edit",e)},delete:function(e){return n["a"].get("/task/delete",e)},stop:function(e){return n["a"].post("/task/stop?id="+e.id,e)},resume:function(e){return n["a"].post("/task/resume?id="+e.id,e)},startNow:function(e){return n["a"].post("/task/startNow?id="+e.id,e)},existsClass:function(e){return n["a"].get("/task/existsClass",e)},existsJobPath:function(e){return n["a"].get("/task/existsJobPath",e)},isOver:function(e){return n["a"].get("/task/get/variables",e)},history:function(e){return n["a"].get("/task/history",e)}}},"7ec2":function(e,t,r){"use strict";r("f2a3")},8771:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:"提示",visible:e.visidible,width:"50%","append-to-body":""},on:{"update:visible":function(t){e.visidible=t}}},[r("KrCron",{attrs:{value:e.crvalue},model:{value:e.cronExpre,callback:function(t){e.cronExpre=t},expression:"cronExpre"}}),r("div",{staticStyle:{"margin-top":"10px"}},[r("span",[e._v("cron表达式：")]),r("el-input",{staticClass:"croninput",model:{value:e.cronExpre,callback:function(t){e.cronExpre=t},expression:"cronExpre"}})],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.visidible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.clickCronOK}},[e._v("确 定")])],1)],1)},a=[],i={data:function(){return{visidible:!1,cronExpre:"",crvalue:""}},methods:{init:function(e,t){this.visidible=!0,"add"==e?this.cronExpre="":(this.cronExpre=t,this.crvalue=t)},clickCronOK:function(){this.visidible=!1,this.$emit("onFinish",this.cronExpre)}}},s=i,o=(r("b474"),r("2877")),c=Object(o["a"])(s,n,a,!1,null,"4b4a355f",null);t["default"]=c.exports},9468:function(e,t,r){},ae9b:function(e,t,r){"use strict";r("9468")},b474:function(e,t,r){"use strict";r("deb4")},b852:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container"},[r("KrSearch",{staticClass:"search",attrs:{searchProps:e.searchProps},on:{search:e.search}}),r("div",{staticClass:"mainview"},[r("kr-table",{ref:"table",attrs:{columns:e.columns,rows:e.tableData,fetchFunc:e.getList,searchParams:e.searchParams},on:{"selection-change":e.handleSelectionChange}},[r("div",{attrs:{slot:"handleButtons"},slot:"handleButtons"},[r("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},on:{click:e.addtask}},[e._v("新增任务")]),r("el-button",{attrs:{icon:"el-icon-delete",type:"danger",plain:"",disabled:0==e.selection.length},on:{click:function(t){return e.del(e.selection)}}},[e._v("批量删除("+e._s(e.selection.length)+")")])],1)])],1),r("listform",{ref:"form"}),r("history",{ref:"history"})],1)},a=[],i=r("1da1"),s=r("5530"),o=(r("96cf"),r("159b"),r("4de4"),r("a15b"),r("d81d"),r("6512")),c=r("2803"),l=r("7dca"),u=r("2f62"),p={computed:Object(s["a"])({getList:function(){return l["a"].list},searchParams:function(){var e={};return this.searchProps.forEach((function(t){e[t.field]=t.value})),e}},Object(u["c"])({size:function(e){return e.config.defaultSize}})),data:function(){this.$createElement;var e=this;return{searchProps:[{isShow:!0,type:"input",field:"name",value:""},{isShow:!0,type:"select",field:"status",model:"启用状态",options:[{label:"启用",value:"1"},{label:"暂停",value:"0"}],value:""}],columns:[{prop:"name",label:"任务名称"},{label:"任务类型",render:function(t,r,n){return t("span",[e.getTypeText(r.jobType)])}},{prop:"group",label:"任务组"},{prop:"description",width:280,label:"描述"},{label:"状态",width:80,render:function(t,r,n){return t("el-switch",{attrs:{value:r.status,"active-value":"1",size:e.size,"inactive-value":"0"},on:{change:function(t){return e.handleStatusChange(r)}}})}},{label:"操作",headerAlign:"center",fixed:"right",align:"right",width:240,render:function(t,r,n){return t("div",[t("el-button",{attrs:{size:e.size,type:"text",icon:"krIconfont kr-xiangxi"},on:{click:function(){return e.history(r,n)}}},["执行历史"]),t("el-button",{attrs:{size:e.size,type:"text",icon:"el-icon-edit-outline"},on:{click:function(){return e.edit(r,n)}}},["编辑"]),t("el-button",{attrs:{size:e.size,type:"text"},on:{click:function(){return e.start(r,n)}},class:"krIconfont kr-icon_fabu"},["执行"]),t("el-button",{attrs:{size:e.size,type:"text"},on:{click:function(){return e.del(r,n)}},class:"krIconfont kr-shanchu danger"},["删除"])])}}],tableData:[],selection:[],cronExpre:"",typeList:[{code:"0",value:"java方法"},{code:"1",value:"SQL脚本"},{code:"2",value:"SQL脚本文件"},{code:"3",value:"LINUX脚本"},{code:"4",value:"LINUX脚本文件"},{code:"5",value:"WINDOWS脚本"},{code:"6",value:"WINDOWS脚本文件"},{code:"7",value:"JS脚本"},{code:"8",value:"JS脚本文件"},{code:"9",value:"python脚本"},{code:"10",value:"python脚本文件"}]}},components:{listform:o["default"],history:c["default"]},methods:{search:function(){this.$refs.table.insidePage=1,this.$refs.table.init()},addtask:function(){this.$refs.form.initForm("add")},edit:function(e,t){this.$refs.form.initForm("edit",e)},history:function(e,t){this.$refs.history.showInfo(e)},getTypeText:function(e){return this.typeList.filter((function(t){return t.code==e}))[0].value},start:function(e){var t=this;this.$confirm("您确认要立即执行该任务吗?","提示",{confirmButtonText:"继续",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,l["a"].startNow({id:e.id});case 2:if(n=r.sent,a=n.data,0==a.code){r.next=7;break}return t.$message.error(a.msg),r.abrupt("return");case 7:t.$message({type:"success",message:"执行成功!"});case 8:case"end":return r.stop()}}),r)}))))},del:function(e){var t=this;if(e instanceof Array||(e=[e]),0==e.length)return this.$message.error("请选择需要删除的项!");this.$confirm("您确认要删除该内容吗？","提示",{confirmButtonText:"继续",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.map((function(e){return e.id})).join(","),r.next=3,l["a"].delete({ids:n});case 3:if(a=r.sent,i=a.data,0==i.code){r.next=8;break}return t.$message.error(i.msg),r.abrupt("return");case 8:t.$refs.table.init(),t.$message({type:"success",message:"删除成功!"});case 10:case"end":return r.stop()}}),r)}))))},handleStatusChange:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:e.status="0"==e.status?"1":"0","0"==e.status?t.stopTask(e.id):t.startTask(e.id);case 2:case"end":return r.stop()}}),r)})))()},startTask:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,l["a"].resume({id:e});case 2:if(n=r.sent,a=n.data,0==a.code){r.next=7;break}return t.$refs.table.init(),r.abrupt("return",t.$message.error(a.msg));case 7:t.$refs.table.init(),t.$message.success(a.msg);case 9:case"end":return r.stop()}}),r)})))()},stopTask:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,l["a"].stop({id:e});case 2:if(n=r.sent,a=n.data,0==a.code){r.next=7;break}return t.$refs.table.init(),r.abrupt("return",t.$message.error(a.msg));case 7:t.$refs.table.init(),t.$message.success(a.msg);case 9:case"end":return r.stop()}}),r)})))()},handleSelectionChange:function(e){this.selection=e}}},d=p,f=(r("ae9b"),r("2877")),m=Object(f["a"])(d,n,a,!1,null,"3e0bad6e",null);t["default"]=m.exports},deb4:function(e,t,r){},f2a3:function(e,t,r){}}]);