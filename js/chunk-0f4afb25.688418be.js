(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0f4afb25"],{"0134":function(e,t,r){"use strict";var a=r("7bc1");t["a"]={list:function(e){return a["a"].get("/data-share/plugin/get",e)},del:function(e){return a["a"].get("/data-share/plugin/remove",e)},demo:function(e){return a["a"].getBlob("/data-share/plugin/downloadDemo",e)}}},"8a57":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{visible:e.visible,title:e.title,width:e.width},on:{"update:visible":function(t){e.visible=t},close:function(t){e.visible=!1}}},[r("el-form",{ref:"form",attrs:{"label-width":"140px",model:e.form,size:"medium",rules:e.rules,disabled:"view"===e.method},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit.apply(null,arguments)}}},[r("el-row",[r("el-row",[r("el-col",{staticClass:"row",attrs:{span:24}},[e._v(" 基本信息 ")]),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"接口目录",prop:"catalogId"}},[r("kr-tree-select",{staticStyle:{width:"100%"},attrs:{clearable:"",props:e.treeProps,nodeKey:"id",data:e.treeData},on:{getValue:e.getValue},model:{value:e.nodeIds,callback:function(t){e.nodeIds=t},expression:"nodeIds"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"接口名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"接口标识",prop:"identity"}},[r("el-input",{attrs:{disabled:"",placeholder:"请输入接口标识"},model:{value:e.form.identity,callback:function(t){e.$set(e.form,"identity",t)},expression:"form.identity"}})],1)],1)],1),r("el-row",[r("el-col",{staticClass:"row",attrs:{span:24}},[e._v(" 资源信息 ")]),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"资源类型",prop:"resourceType"}},[r("el-radio-group",{model:{value:e.form.resourceType,callback:function(t){e.$set(e.form,"resourceType",t)},expression:"form.resourceType"}},[r("el-radio-button",{attrs:{label:"0"}},[e._v("模型资源")]),r("el-radio-button",{attrs:{label:"1"}},[e._v("外部接口资源")])],1)],1)],1),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"请求方式",prop:"requestMethod"}},[r("el-select",{attrs:{placeholder:"请输入请求方式"},model:{value:e.form.requestMethod,callback:function(t){e.$set(e.form,"requestMethod",t)},expression:"form.requestMethod"}},e._l(0==e.form.resourceType?["GET","POST"]:["GET","POST","PUT","DELETE","HEAD"],(function(e,t){return r("el-option",{key:t,attrs:{value:e,label:e}})})),1)],1)],1),0==e.form.resourceType?[r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"选择资源"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",remote:"",filterable:"","remote-method":e.remoteModel},model:{value:e.sourceId,callback:function(t){e.sourceId=t},expression:"sourceId"}},e._l(e.sourceList.filter((function(e){return 0==e.resourceType})),(function(e,t){return r("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1)],1),e.form.modelApi.dataSourceId?r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"查询条件"}},[r("el-tabs",{attrs:{type:"card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[r("el-tab-pane",{attrs:{label:"选择查询字段",name:"1"}},[r("el-table",{ref:"modelTable",attrs:{data:e.fieldsList,size:"mini",stripe:"",border:""},on:{"selection-change":e.selectChange}},[r("el-table-column",{attrs:{type:"selection"}}),r("el-table-column",{attrs:{label:"序号",type:"index"}}),r("el-table-column",{attrs:{prop:"columnName",label:"字段名"}}),r("el-table-column",{attrs:{prop:"columnType",label:"字段类型"}}),r("el-table-column",{attrs:{prop:"remarks",label:"字段描述"}})],1)],1),r("el-tab-pane",{attrs:{label:"添加查询条件",name:"2"}},[r("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:e.addField}},[e._v("添加条件")]),r("el-table",{attrs:{size:"mini",data:e.form.modelApi.conditions,stripe:"",rules:e.modelRules,border:""}},[r("el-table-column",{attrs:{prop:"field",label:"字段"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-select",{attrs:{size:"mini"},on:{change:function(r){return e.choseField(r,t.row)}},model:{value:t.row.field,callback:function(r){e.$set(t.row,"field",r)},expression:"s.row.field"}},e._l(e.fieldsList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.columnName,value:e.columnName}})})),1)]}}],null,!1,291761045)}),r("el-table-column",{attrs:{prop:"paramName",label:"字段别名"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input",{attrs:{size:"mini"},model:{value:t.row.paramName,callback:function(r){e.$set(t.row,"paramName",r)},expression:"s.row.paramName"}})]}}],null,!1,150706061)}),r("el-table-column",{attrs:{prop:"operator",label:"比较条件"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-select",{attrs:{size:"mini"},model:{value:t.row.operator,callback:function(r){e.$set(t.row,"operator",r)},expression:"s.row.operator"}},e._l([">","<","=",">=","<=","!=","in","like"],(function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})})),1)]}}],null,!1,876885037)}),r("el-table-column",{attrs:{prop:"conditionValue",label:"条件值"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input",{attrs:{size:"mini"},model:{value:t.row.conditionValue,callback:function(r){e.$set(t.row,"conditionValue",r)},expression:"s.row.conditionValue"}})]}}],null,!1,2534195069)}),r("el-table-column",{attrs:{prop:"jdbcDataType",label:"值类型"}}),r("el-table-column",{attrs:{prop:"must",align:"center",label:"是否必须"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:t.row.must,callback:function(r){e.$set(t.row,"must",r)},expression:"s.row.must"}})]}}],null,!1,3472594021)}),r("el-table-column",{attrs:{prop:"remarks",label:"备注"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input",{attrs:{size:"mini",type:"textarea",rows:"1"},model:{value:t.row.remarks,callback:function(r){e.$set(t.row,"remarks",r)},expression:"s.row.remarks"}})]}}],null,!1,3266042542)}),r("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{circle:"",icon:"el-icon-delete",type:"danger",size:"mini"},on:{click:function(r){return e.delField(t.row,t.$index)}}})]}}],null,!1,4006472291)})],1)],1)],1)],1)],1):e._e()]:e._e(),[r("el-col",{directives:[{name:"show",rawName:"v-show",value:1==e.form.resourceType,expression:"form.resourceType == 1"}],attrs:{span:24}},[r("el-form-item",{attrs:{label:"选择资源",prop:"httpResource.id"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",remote:"",filterable:"","remote-method":e.remoteModel},on:{change:e.changeHttpModel},model:{value:e.sourceId,callback:function(t){e.sourceId=t},expression:"sourceId"}},e._l(e.httpSouceList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"插件配置"}},[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.addPlugin}},[e._v("添加插件")]),r("span",{staticStyle:{"font-size":"12px","margin-left":"20px",color:"#e08300"}},[r("i",{staticClass:"el-icon-warning"}),e._v(" 排在上面的插件先执行噢~ ")]),r("el-table",{ref:"pluginTable",attrs:{"row-key":function(e){return e.className},data:e.pluginParams,fit:"",border:"",stripe:""}},[r("el-table-column",{attrs:{width:"50"}},[r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"拖拽可以排序哦~",placement:"left"}},[r("i",{staticClass:"el-icon-sort",staticStyle:{color:"blue",cursor:"pointer"}})])],1),r("el-table-column",{attrs:{label:"插件名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-select",{model:{value:t.row.className,callback:function(r){e.$set(t.row,"className",r)},expression:"s.row.className"}},e._l(e.plugins,(function(e,t){return r("el-option",{key:t,attrs:{value:e.className,label:e.name}})})),1),t.row.className?r("el-tooltip",{staticStyle:{"margin-left":"20px"}},[r("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.getDesc(t.row.className))},slot:"content"}),r("i",{staticClass:"el-icon-warning"})]):e._e()]}}])}),r("el-table-column",{attrs:{label:"参数值"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input",{attrs:{size:"mini"},model:{value:t.row.value,callback:function(r){e.$set(t.row,"value",r)},expression:"s.row.value"}})]}}])}),r("el-table-column",{attrs:{width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",circle:"",type:"danger",icon:"el-icon-delete"},on:{click:function(r){return e.delPlugin(t.row,t.$index)}}})]}}])})],1)],1)],1)],2),r("el-row",[r("el-col",{staticClass:"row",attrs:{span:24}},[e._v("扩展字段")]),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"协议方式",prop:"extraApiProtocol"}},[r("el-input",{attrs:{placeholder:"请输入协议方式"},model:{value:e.form.extraApiProtocol,callback:function(t){e.$set(e.form,"extraApiProtocol",t)},expression:"form.extraApiProtocol"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"服务类型",prop:"extraApiType"}},[r("el-input",{attrs:{placeholder:"请输入服务类型"},model:{value:e.form.extraApiType,callback:function(t){e.$set(e.form,"extraApiType",t)},expression:"form.extraApiType"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"技术支持单位电话",prop:"extraSupportDeptTel"}},[r("el-input",{attrs:{placeholder:"请输入技术支持单位电话"},model:{value:e.form.extraSupportDeptTel,callback:function(t){e.$set(e.form,"extraSupportDeptTel",t)},expression:"form.extraSupportDeptTel"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"技术支持单位联系人",prop:"extraSupportDeptContact"}},[r("el-input",{attrs:{placeholder:"请输入技术支持单位联系人"},model:{value:e.form.extraSupportDeptContact,callback:function(t){e.$set(e.form,"extraSupportDeptContact",t)},expression:"form.extraSupportDeptContact"}})],1)],1),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"技术支持单位",prop:"extraSupportDept"}},[r("el-input",{attrs:{placeholder:"请输入技术支持单位"},model:{value:e.form.extraSupportDept,callback:function(t){e.$set(e.form,"extraSupportDept",t)},expression:"form.extraSupportDept"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"是否启用",prop:"usable"}},[r("el-radio-group",{model:{value:e.form.usable,callback:function(t){e.$set(e.form,"usable",t)},expression:"form.usable"}},[r("el-radio-button",{attrs:{label:"1"}},[e._v("是")]),r("el-radio-button",{attrs:{label:"0"}},[e._v("否")])],1)],1)],1),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"备注",prop:"remarks"}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:e.form.remarks,callback:function(t){e.$set(e.form,"remarks",t)},expression:"form.remarks"}})],1)],1)],1)],1)],1),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"success"},on:{click:e.testApi}},[e._v("测 试")]),r("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1),r("el-dialog",{attrs:{visible:e.showTest,title:"测试","append-to-body":"",width:"70%"},on:{close:function(t){e.showTest=!1}}},[0==e.form.resourceType?[r("el-form",{ref:"testForm",attrs:{inline:"",model:e.searchParams,size:"mini"}},[e._l(e.form.modelApi.conditions.filter((function(e){return!e.conditionValue})),(function(t,a){return r("el-form-item",{key:a,attrs:{label:t.paramName||t.field+"：",prop:t.paramName||t.field,required:t.must}},[r("el-input",{attrs:{size:"mini",placeholder:t.paramName||t.field},model:{value:e.searchParams[t.paramName||t.field],callback:function(r){e.$set(e.searchParams,t.paramName||t.field,r)},expression:"searchParams[v.paramName || v.field]"}})],1)})),r("el-form-item",[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.send}},[e._v("发送请求")])],1)],2),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.testResult,size:"mini",stripe:"",border:""}},e._l(e.testList,(function(t,a){return r("el-table-column",{key:a,attrs:{label:t.field,prop:t.prop},scopedSlots:e._u([{key:"default",fn:function(r){return[e._v(" "+e._s(r.row[t.prop])+" ")]}}],null,!0)})})),1),r("el-pagination",{staticStyle:{float:"right"},attrs:{"current-page":e.testPage,"page-sizes":[10,20,30,40],"page-size":e.testSize,layout:"total, sizes, prev, pager, next, jumper",total:e.testResultTotal},on:{"size-change":e.testSizeChange,"current-change":e.testPageChange}})]:[r("el-form",{ref:"testForm",attrs:{inline:"",model:e.searchParams,size:"mini"}},[e._l(e.form.httpResource.httpResourceParams.filter((function(e){return!e.paramValue})),(function(t,a){return r("el-form-item",{key:a,attrs:{label:t.paramKey+"：",prop:t.paramKey,required:t.must}},[r("el-input",{attrs:{size:"mini",placeholder:t.paramKey},model:{value:e.searchParams[t.paramKey],callback:function(r){e.$set(e.searchParams,t.paramKey,r)},expression:"searchParams[v.paramKey]"}})],1)})),r("el-form-item",[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.send}},[e._v("发送请求")])],1)],2),r("div",[r("json-viewer",{attrs:{value:e.testResult,"expand-depth":3,copyable:""}})],1)]],2)],1)},n=[],s=r("5530"),o=r("b85c"),l=r("1da1"),i=(r("96cf"),r("caad"),r("d81d"),r("ac1f"),r("1276"),r("5319"),r("4de4"),r("7db0"),r("c740"),r("a4d3"),r("e01a"),r("a434"),r("a15b"),r("0f52")),c=r("aa47"),u=r("d4ec"),d=r("ade3"),p=function e(){Object(u["a"])(this,e),Object(d["a"])(this,"apiDoc",""),Object(d["a"])(this,"catalogId",""),Object(d["a"])(this,"extraApiProtocol",""),Object(d["a"])(this,"extraApiType",""),Object(d["a"])(this,"extraSupportDept",""),Object(d["a"])(this,"extraSupportDeptContact",""),Object(d["a"])(this,"originalResourceId",""),Object(d["a"])(this,"extraSupportDeptTel",""),Object(d["a"])(this,"httpResource",{bodyType:"",charset:"",httpMethod:"",httpResourceParams:[],id:"",retryCount:0,retryInterval:0,successWhen:"",url:""}),Object(d["a"])(this,"identity",""),Object(d["a"])(this,"modelApi",{columns:"",conditions:[],dataSourceId:"",id:0,querySqlXml:"",schemaName:"",tableName:"",queryColumnList:[]}),Object(d["a"])(this,"name",""),Object(d["a"])(this,"remarks",""),Object(d["a"])(this,"requestMethod",""),Object(d["a"])(this,"resourceId",0),Object(d["a"])(this,"resourceType",0),Object(d["a"])(this,"usable",0)},m=r("8dbd"),f=r("ecef"),b=r("0134"),h=r("2b0e"),g=r("349e"),y=r.n(g);h["default"].use(y.a);var v={components:{},props:{width:{type:String,default:"80%"},treeData:{type:Array,default:function(){return[]}},treeProps:{type:Object,default:function(){return{children:"children",label:"name",disabled:"disabled"}}}},data:function(){var e=function(e,t,r){if(["page","size","open-api-token","open-api-ak","open-api-sn"].includes(t))return r(new Error("不能出现关键字，请重新输入"));r()},t=function(e,t,r){if(["open-api-token","open-api-ak","open-api-sn"].includes(t))return r(new Error("不能出现关键字，请重新输入"));r()};return{showTest:!1,testSize:10,testPage:1,testResult:[],testResultTotal:0,searchParams:{},loading:!1,testRules:{},testModel:{},plugins:[],UploadLoading:!1,pluginData:{pid:0,source:"file"},sourceId:"",selection:[],activeName:"1",sourceList:[],tableList:[],visible:!1,defaultProps:{children:"children",label:"name"},defaultProps2:{children:"children",label:"name"},defaultKeys:[],orgTree:[],userTree:[],nodeIds:"",parentId:"",companyId:1,showTree:!1,people:[],method:"",form:new p,rules:{type:[{required:!0,message:"类型不能为空",trigger:"blur"}],name:[{required:!0,message:"名称不能为空",trigger:"blur"}],catalogId:[{required:!0,message:"接口目录不能为空",trigger:"blur"}]},modelRules:{paramName:[{validator:e,trigger:"blur"}]},httpRules:{paramKey:[{validator:t,trigger:"blur"}]},id:"",title:"",disabled:!1,userArr:[],fieldsList:[],pluginParams:[]}},computed:{testList:function(){return this.form.modelApi.columns.split(",").map((function(e){return{field:e,prop:e.replace(/_(\w)/g,(function(e,t){return t.toUpperCase()}))}}))},httpSouceList:function(){return this.sourceList.filter((function(e){return 1==e.resourceType}))}},watch:{sourceId:{immediate:!0,deep:!0,handler:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function r(){var a,n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!e){r.next=15;break}if(a=t.sourceList.find((function(t){return t.id==e})),!a){r.next=15;break}if(0!=t.form.resourceType){r.next=13;break}return t.form.modelApi.schemaName=a.modelResource.schemaName,t.form.modelApi.tableName=a.modelResource.tableName,t.form.modelApi.id=a.modelResource.dataSourceId,t.form.modelApi.dataSourceId=a.modelResource.dataSourceId,r.next=10,f["a"].more({dataSourceId:a.modelResource.dataSourceId,tableName:a.modelResource.tableName,schemaName:a.modelResource.schemaName});case 10:n=r.sent,s=n.data,t.fieldsList=s.data.columns;case 13:t.form.resourceId=e,t.form.originalResourceId=e;case 15:case"end":return r.stop()}}),r)})))()}},fieldsList:{immediate:!0,deep:!0,handler:function(e){var t=this;this.fieldsList.length>0&&this.$nextTick((function(){if(t.form.modelApi.columns){var e,r=t.form.modelApi.columns.split(","),a=Object(o["a"])(r);try{var n=function(){var r=e.value,a=t.fieldsList.find((function(e){return e.columnName==r}));a&&t.$refs.modelTable.toggleRowSelection(a)};for(a.s();!(e=a.n()).done;)n()}catch(s){a.e(s)}finally{a.f()}}}))}},"form.resourceType":{immediate:!0,handler:function(e){var t=this;this.sourceList.filter((function(t){return t.resourceType==e})).find((function(e){return e.id==t.form.originalResourceId}))?this.sourceId=this.form.originalResourceId:this.sourceId=""}}},methods:{getDesc:function(e){var t=this.plugins.findIndex((function(t){return t.className==e}));return this.plugins[t].description.replace(/\r|\n/g,"<br>")},rowDrop:function(){var e=this.$refs.pluginTable.$el.querySelector(".el-table__body-wrapper tbody"),t=this;c["default"].create(e,{onEnd:function(e){var r=e.newIndex,a=e.oldIndex,n=t.pluginParams.splice(a,1)[0];t.pluginParams.splice(r,0,n)}})},addPlugin:function(){this.pluginParams.push({className:"",value:""})},delPlugin:function(e,t){this.pluginParams.splice(t,1)},testSizeChange:function(e){this.testSize=e,this.send()},testPageChange:function(e){this.testPage=e,this.send()},send:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var r,a,n,o,c,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0==e.form.resourceType){for(a in r=Object(s["a"])({page:e.testPage,size:e.testSize},e.searchParams),r)r[a]||delete r[a];e.form.param=r,n={},n.modelApi=e.form.modelApi,n.httpResource=e.form.httpResource,n.resourceType=e.form.resourceType,n.param=r,e.$refs.testForm.validate(function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(r){var a,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=18;break}return e.loading=!0,t.next=4,i["a"].test(n);case 4:if(a=t.sent,s=a.data,e.loading=!1,o=JSON.parse(s.data.result),o.records instanceof Array||(o.records=[o.records]),e.testResult=o.records,e.testResultTotal=o.total,0!=s.code){t.next=15;break}return t.abrupt("return",e.$message.success(s.data.message));case 15:return t.abrupt("return",e.$message.error(s.data.message));case 16:t.next=19;break;case 18:return t.abrupt("return",!1);case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}else{for(c in o=Object(s["a"])({},e.searchParams),o)o[c]||delete o[c];u={},u.modelApi=e.form.modelApi,u.httpResource=e.form.httpResource,u.resourceType=e.form.resourceType,u.param=o,e.$refs.testForm.validate(function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(r){var a,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=16;break}return e.loading=!0,t.next=4,i["a"].test(u);case 4:if(a=t.sent,n=a.data,e.loading=!1,s=JSON.parse(n.data.result),e.testResult=s,0!=n.code){t.next=13;break}return t.abrupt("return",e.$message.success(n.data.message));case 13:return t.abrupt("return",e.$message.error(n.data.message));case 14:t.next=17;break;case 16:return t.abrupt("return",!1);case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}case 1:case"end":return t.stop()}}),t)})))()},testApi:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.searchParams={},e.$nextTick(Object(l["a"])(regeneratorRuntime.mark((function t(){var r,a,n,s,l,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.testResult=[],0!=e.form.resourceType){t.next=6;break}r=Object(o["a"])(e.form.modelApi.conditions.filter((function(e){return!e.conditionValue})));try{for(r.s();!(a=r.n()).done;)n=a.value,e.$set(e.searchParams,n.paramName||n.field,""),n.must&&e.$set(e.testRules,n.paramName||n.field,[{required:!0,message:"必填项",trigger:"blur"}])}catch(c){r.e(c)}finally{r.f()}t.next=10;break;case 6:return t.next=8,e.changeHttpModel(e.form.resourceId);case 8:s=Object(o["a"])(e.form.httpResource.httpResourceParams);try{for(s.s();!(l=s.n()).done;)i=l.value,e.$set(e.searchParams,i.paramKey,""),i.must&&e.$set(e.testRules,i.paramKey,[{required:!0,message:"必填项",trigger:"blur"}])}catch(c){s.e(c)}finally{s.f()}case 10:e.showTest=!0;case 11:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t)})))()},selectChange:function(e){this.selection=e,this.form.modelApi.columns=e.map((function(e){return e.columnName})).join(","),this.form.modelApi.queryColumnList=e.map((function(e){return{type:e.columnType,name:e.columnName,remarks:e.remarks}}))},choseField:function(e,t){this.$set(t,"jdbctype",this.fieldsList.find((function(t){return t.columnName==e})).typeName),this.$set(t,"paramName",e.replace(/_(\w)/g,(function(e,t){return t.toUpperCase()})))},delField:function(e,t){this.form.modelApi.conditions.splice(t,1)},addField:function(){this.form.modelApi.conditions.push({conditionValue:"",field:"",id:0,modelApiId:0,must:0,operator:"",paramName:"",jdbcDataType:"",paramType:"",remarks:""})},remoteModel:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,f["a"].list({current:1,page:20,keyword:e});case 2:a=r.sent,n=a.data,t.sourceList=n.data.records;case 5:case"end":return r.stop()}}),r)})))()},changeHttpModel:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,f["a"].getById({id:e});case 2:a=r.sent,n=a.data,t.form.httpResource=n.data.httpResource;case 5:case"end":return r.stop()}}),r)})))()},init:function(e,t,r){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a.method=e,a.form=new p,r.next=4,a.remoteModel();case 4:a.sourceId="",a.pluginParams=[],"add"===e?(a.nodeIds="",a.title="新建"):a.title="view"===e?"查看":"编辑",a.id=t,a.visible=!0,a.$nextTick(Object(l["a"])(regeneratorRuntime.mark((function r(){var n,s,o,l,c,u,d,p;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a.$refs.form.resetFields(),r.next=3,m["a"].tree();case 3:return n=r.sent,s=n.data,a.tagTree=s.data,r.next=8,b["a"].list();case 8:if(o=r.sent,l=o.data,a.plugins=l.data,"edit"!==e&&"view"!==e){r.next=24;break}return r.next=14,i["a"].detail({id:t});case 14:c=r.sent,u=c.data,a.pluginParams=JSON.parse(u.data.pluginParam)||[],a.form=u.data,u.data.httpResource||(u.data.httpResource={bodyType:"",charset:"",httpMethod:"",httpResourceParams:[],id:"",retryCount:0,retryInterval:0,successWhen:"",url:""}),u.data.modelApi||(a.form.modelApi={columns:"",conditions:[],dataSourceId:"",id:0,querySqlXml:"",schemaName:"",tableName:"",queryColumnList:[]}),a.sourceId=u.data.originalResourceId,a.nodeIds=u.data.catalogId,r.next=29;break;case 24:return r.next=26,i["a"].getIdentity();case 26:d=r.sent,p=d.data,a.form.identity=p.data;case 29:a.rowDrop(),a.$forceUpdate();case 31:case"end":return r.stop()}}),r)}))));case 10:case"end":return r.stop()}}),r)})))()},getValue:function(e){this.form.catalogId=e?e.id:""},choseTag:function(e){var t=this.tags.findIndex((function(t){return t.nodeIds==e.nodeIds}));t>-1?this.tags.splice(t,1):this.tags.push(e)},delTag:function(e){this.tags.splice(e,1)},submitTags:function(){},submit:function(){var e=this;try{this.$refs.form.validate(function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(r){var a,n,s,o,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=25;break}if(a=e.form,a.pluginParam=JSON.stringify(e.pluginParams),"add"!=e.method&&"addChild"!=e.method){t.next=13;break}return t.next=6,i["a"].add(a);case 6:if(n=t.sent,s=n.data,0==s.code){t.next=10;break}return t.abrupt("return",e.$message.error(s.msg));case 10:e.$message.success(s.msg),t.next=21;break;case 13:if("edit"!=e.method){t.next=21;break}return t.next=16,i["a"].save(a);case 16:if(o=t.sent,l=o.data,0==l.code){t.next=20;break}return t.abrupt("return",e.$message.error(l.msg));case 20:e.$message.success(l.msg);case 21:e.$emit("update"),e.visible=!1,t.next=26;break;case 25:return t.abrupt("return",!1);case 26:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}catch(t){this.$message.error(t)}}}},k=v,w=(r("e419"),r("2877")),x=Object(w["a"])(k,a,n,!1,null,"790d2966",null);t["default"]=x.exports},"8dbd":function(e,t,r){"use strict";var a=r("7bc1");t["a"]={tree:function(e){return a["a"].get("/data-share/resource-tag/getTree",e)},use:function(e){return a["a"].get("/data-share/resource-tag/updateUsableById",e)},add:function(e){return a["a"].post("/data-share/resource-tag/add",e)},save:function(e){return a["a"].post("/data-share/resource-tag/edit",e)},del:function(e){return a["a"].get("/data-share/resource-tag/deleteById",e)}}},c24f:function(e,t,r){},d4ec:function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.d(t,"a",(function(){return a}))},e419:function(e,t,r){"use strict";r("c24f")},ecef:function(e,t,r){"use strict";var a=r("7bc1");t["a"]={list:function(e){return a["a"].post("/data-share/resource/page",e)},add:function(e){return a["a"].post("/data-share/resource/add",e)},del:function(e){return a["a"].get("/data-share/resource/deleteById",e)},save:function(e){return a["a"].post("/data-share/resource/edit",e)},detail:function(e){return a["a"].get("/data-share/resource/getById",e)},more:function(e){return a["a"].get("/data-share/resource/getTableDetail",e)},modelDetail:function(e){return a["a"].get("/data-share/resource/getTableDetailById",e)},getTableModelList:function(e){return a["a"].get("/data-share/resource/getTableModelList",e)},getById:function(e){return a["a"].get("/data-share/resource/getById",e)}}}}]);