(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-afa27fba","chunk-0e6d02f2","chunk-4eb5e331"],{"0897":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{visible:e.visible,title:e.title,width:e.width},on:{"update:visible":function(t){e.visible=t},close:function(t){e.visible=!1}}},[r("el-form",{ref:"form",attrs:{"label-width":"120px",model:e.form,size:"medium",rules:e.rules,disabled:"view"===e.method},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit.apply(null,arguments)}}},[r("el-row",[1!=e.form.flag?r("el-col",{attrs:{span:24}},["add"===e.method?r("el-form-item",{attrs:{label:"类型",prop:"flag"}},[r("el-radio-group",{model:{value:e.form.flag,callback:function(t){e.$set(e.form,"flag",t)},expression:"form.flag"}},e._l(e.flagList,(function(t){return r("el-radio-button",{key:t.code,attrs:{label:t.code}},[e._v(e._s(t.value))])})),1)],1):r("el-form-item",{attrs:{label:"类型"}},[r("el-button",{attrs:{type:"primary"}},[e._v(e._s(e.getType(this.form.flag)))])],1)],1):e._e(),1!=e.form.flag?r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"上级机构",prop:"parentNodeIds"}},[e.showSelect?r("kr-tree-select",{ref:"treeSelect",staticStyle:{width:"100%"},attrs:{disabled:e.disabled,props:e.treeProps,nodeKey:"nodeIds",data:e.treeData},on:{getValue:e.getValue},model:{value:e.nodeIds,callback:function(t){e.nodeIds=t},expression:"nodeIds"}}):e._e()],1)],1):e._e(),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:e.label+"名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),r("el-col",{attrs:{span:24}},[3==e.form.flag?r("el-form-item",{attrs:{label:e.label+"类型",prop:"type"}},[r("el-select",{staticStyle:{width:"100%"},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.typeList,(function(e){return r("el-option",{key:e.code,attrs:{value:Number(e.code),label:e.value}})})),1)],1):e._e()],1),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"是否可用",prop:"useable"}},[r("el-radio-group",{model:{value:e.form.useable,callback:function(t){e.$set(e.form,"useable",t)},expression:"form.useable"}},[r("el-radio-button",{attrs:{label:1}},[e._v("是")]),r("el-radio-button",{attrs:{label:0}},[e._v("否")])],1)],1)],1),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"排序",prop:"sort"}},[r("el-input-number",{attrs:{min:1,label:"排序"},model:{value:e.form.sort,callback:function(t){e.$set(e.form,"sort",t)},expression:"form.sort"}})],1)],1),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"备注",prop:"remarks"}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:e.form.remarks,callback:function(t){e.$set(e.form,"remarks",t)},expression:"form.remarks"}})],1)],1)],1)],1),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取 消")]),r("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)],1)},n=[],s=r("1da1"),i=r("b85c"),o=(r("96cf"),r("caad"),r("2532"),r("c740"),r("f477")),l=r("3074"),c=r("d4ec"),u=r("ade3"),d=function e(){Object(c["a"])(this,e),Object(u["a"])(this,"code",""),Object(u["a"])(this,"flag",""),Object(u["a"])(this,"fullName",""),Object(u["a"])(this,"id",""),Object(u["a"])(this,"name",""),Object(u["a"])(this,"nodeId",""),Object(u["a"])(this,"parentNodeIds",""),Object(u["a"])(this,"nodeIds",""),Object(u["a"])(this,"remarks",""),Object(u["a"])(this,"sort",1),Object(u["a"])(this,"type",""),Object(u["a"])(this,"useable",1)};function f(e,t){var r,a=Object(i["a"])(e);try{for(a.s();!(r=a.n()).done;){var n=r.value;t.includes(n.flag)?n.disabled=!1:n.disabled=!0,n.children&&n.children.length>0&&f(n.children,t)}}catch(s){a.e(s)}finally{a.f()}return e}var m={props:{width:{type:String,default:"50%"},treeData:{type:Array,default:function(){return[]}},treeProps:{type:Object,default:function(){return{children:"children",label:"name"}}}},data:function(){return{visible:!1,showSelect:!0,method:"",form:new d,rules:{parentNodeIds:[{required:!0,message:"上级机构不能为空",trigger:"blur"}],flag:[{required:!0,message:"机构类型不能为空",trigger:"blur"}],name:[{required:!0,message:"机构名称不能为空",trigger:"blur"}]},id:"",title:"",originData:[],flagList:[],typeList:[],nodeIds:""}},computed:{disabled:function(){return!this.form.flag},label:function(){return 2==this.form.flag?"部门":3==this.form.flag?"岗位":""}},watch:{"form.flag":{handler:function(e){var t=this;this.showSelect=!1,3==e?this.treeData=f(this.treeData,[2]):2==e&&(this.treeData=f(this.treeData,[1,2])),this.$nextTick((function(){t.showSelect=!0}))}}},methods:{init:function(e,t,r){var a=this;this.id=t,this.visible=!0,this.$nextTick(Object(s["a"])(regeneratorRuntime.mark((function n(){var s,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a.$refs.form.resetFields(),a.nodeIds="",a.form.parentNodeIds="",a.flagList=o["a"].getDictList("sys_company_flag"),a.typeList=o["a"].getDictList("sys_post_type"),a.originData=JSON.parse(JSON.stringify(a.treeData)),a.form=new d,a.flagList=[a.flagList[1],a.flagList[2]],a.method=e,"add"===e?(a.form.parentNodeIds="",a.title="新建"):"view"===e?a.title="查看":"addChildOffice"===e?(a.title="添加部门",a.flagList=[a.flagList[0]],a.form.flag=2,a.nodeIds=r.nodeIds,a.form.parentNodeIds=r.nodeIds):"addChildPost"===e?(a.title="添加岗位",a.flagList=[a.flagList[1]],a.nodeIds=r.nodeIds,a.form.parentNodeIds=r.nodeIds,a.form.flag=3):a.title="编辑","edit"!==e&&"view"!==e){n.next=20;break}return n.next=13,l["a"].queryById({orgId:t,flag:r.flag});case 13:if(s=n.sent,i=s.data,0==i.code){n.next=18;break}return a.$message.error("获取数据失败"),n.abrupt("return");case 18:a.form=i.data,a.nodeIds=i.data.parentNodeIds;case 20:case"end":return n.stop()}}),n)}))))},getType:function(e){var t=this.flagList.findIndex((function(t){return t.code==e}));return t>-1?this.flagList[t].value:"无"},getValue:function(e){if("add"==this.method&&3==this.form.flag&&2!=e.flag)return this.$message.error("只能选择部门作为岗位的上级");this.form.parentNodeIds=e.nodeIds},submit:function(){var e=this;try{this.$refs.form.validate(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(r){var a,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=13;break}return a=e.form,t.next=4,l["a"].save(a);case 4:if(n=t.sent,s=n.data,0==s.code){t.next=8;break}return t.abrupt("return",e.$message.error(s.msg));case 8:e.$message.success(s.msg),e.$emit("update"),e.visible=!1,t.next=14;break;case 13:return t.abrupt("return",!1);case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}catch(t){this.$message.error(t)}}}},p=m,b=r("2877"),h=Object(b["a"])(p,a,n,!1,null,null,null);t["default"]=h.exports},3521:function(e,t,r){"use strict";var a=r("7bc1");t["a"]={bindMenu:function(e){return a["a"].post("/sys/bind/bindMenu",e)},list:function(e){return a["a"].post("/sys/bind/queryBindMenus",e)},bindRole:function(e){return a["a"].post("/sys/bind/userBindRoles",e)}}},"70e5":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{visible:e.visible,title:"权限分配",width:e.width},on:{"update:visible":function(t){e.visible=t},close:function(t){e.visible=!1}}},[r("el-form",{ref:"form",attrs:{size:"medium"}},[r("el-row",[r("el-col",{attrs:{span:24}},[r("el-form-item",[r("kr-tree",{ref:"tree",staticClass:"tree",attrs:{data:e.treeData,props:e.treeProps,"node-key":e.nodeKey,"show-checkbox":"","default-expanded-keys":e.treeExpandData,"default-checked-keys":e.defaultKeys},on:{check:e.getChecked}})],1)],1)],1)],1),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取 消")]),r("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)],1)},n=[],s=r("2909"),i=r("1da1"),o=r("b85c"),l=(r("96cf"),r("a9e3"),r("99af"),r("3521")),c=r("eb40"),u=r("0208");function d(e,t){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=Object(o["a"])(e);try{for(i.s();!(r=i.n()).done;){var l=r.value;a.push(l[n]),s>=t||l.children&&l.children.length>0&&(s++,d(l.children,t,a,s))}}catch(c){i.e(c)}finally{i.f()}}var f={props:{width:{type:String,default:"30%"},nodeKey:{type:String,default:"id"},level:{type:Number,default:1},type:{type:String,default:"role"}},data:function(){return{visible:!1,id:"",authList:[],defaultKeys:[],treeData:[],treeProps:{children:"children",label:"name",disabled:"disabled"}}},mounted:function(){this.getAuthTree()},computed:{treeExpandData:function(){var e=[];return d(this.treeData,this.level,e,this.nodeKey),e}},methods:{init:function(e){var t=this;this.id=e,this.visible=!0,this.$nextTick(Object(i["a"])(regeneratorRuntime.mark((function r(){var a,n,s,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.$refs.tree.$refs.tree.setCheckedKeys([]),a={},r.t0=t.type,r.next="role"===r.t0?5:"user"===r.t0?7:"post"===r.t0?9:"admin"===r.t0?11:13;break;case 5:return a.roleId=e,r.abrupt("break",14);case 7:return a.userId=e,r.abrupt("break",14);case 9:return a.postId=e,r.abrupt("break",14);case 11:return a.id=e,r.abrupt("break",14);case 13:return r.abrupt("break",14);case 14:if("admin"!=t.type){r.next=22;break}return r.next=17,c["a"].getMenus({id:e});case 17:n=r.sent,s=n.data,s.data.length>0&&(t.defaultKeys=s.data),r.next=27;break;case 22:return r.next=24,l["a"].list(a);case 24:i=r.sent,o=i.data,o.data.length>0&&(t.defaultKeys=o.data);case 27:case"end":return r.stop()}}),r)}))))},getAuthTree:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,u["a"].getFilterMenu({flag:1});case 2:r=t.sent,a=r.data,e.treeData=a.data.children;case 5:case"end":return t.stop()}}),t)})))()},getChecked:function(e,t){this.authList=[].concat(Object(s["a"])(t.checkedKeys),Object(s["a"])(t.halfCheckedKeys))},submit:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,a,n,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:t.prev=0,r={menuIds:[].concat(Object(s["a"])(e.$refs.tree.getCheckedKeys()),Object(s["a"])(e.$refs.tree.getHalfCheckedKeys())),postId:null,roleId:null,userId:null},t.t0=e.type,t.next="role"===t.t0?5:"post"===t.t0?7:"user"===t.t0?9:11;break;case 5:return r.roleId=e.id,t.abrupt("break",12);case 7:return r.postId=e.id,t.abrupt("break",12);case 9:return r.userId=e.id,t.abrupt("break",12);case 11:return t.abrupt("break",12);case 12:if("admin"!=e.type){t.next=23;break}return t.next=15,c["a"].saveMenus({id:e.id,menuIds:[].concat(Object(s["a"])(e.$refs.tree.getCheckedKeys()),Object(s["a"])(e.$refs.tree.getHalfCheckedKeys()))});case 15:if(a=t.sent,n=a.data,0==n.code){t.next=19;break}return t.abrupt("return",e.$message.error(n.msg));case 19:e.$message.success(n.msg),e.visible=!1,t.next=31;break;case 23:return t.next=25,l["a"].bindMenu(r);case 25:if(i=t.sent,o=i.data,0==o.code){t.next=29;break}return t.abrupt("return",e.$message.error(o.msg));case 29:e.$message.success(o.msg),e.visible=!1;case 31:e.$emit("update"),t.next=37;break;case 34:t.prev=34,t.t1=t["catch"](0),e.$message.error(t.t1);case 37:case"end":return t.stop()}}),t,null,[[0,34]])})))()}}},m=f,p=r("2877"),b=Object(p["a"])(m,a,n,!1,null,null,null);t["default"]=b.exports},"7fb9":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-row",{staticClass:"container"},[r("el-col",{staticClass:"content",attrs:{span:24}},[r("kr-table",{ref:"table",attrs:{columns:e.columns,fetchFunc:e.getTree,searchParams:e.searchParams,getTree:"",rowKey:"nodeIds",level:2,selection:!1,showPagination:!1},on:{getData:e.getData,"selection-change":e.handleSelectionChange}},[r("div",{attrs:{slot:"handleButtons"},slot:"handleButtons"},[r("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},on:{click:e.add}},[e._v("新建")])],1),e.user.isSingleCompany?e._e():r("div",{attrs:{slot:"company"},slot:"company"},[e.showUserCompanyTree?r("kr-tree-select",{attrs:{data:e.companyTree,props:e.treeProps,nodeKey:"id"},on:{getValue:e.changeCompany},model:{value:e.companyId,callback:function(t){e.companyId=t},expression:"companyId"}}):e._e()],1)])],1),r("listForm",{ref:"listForm",attrs:{treeData:e.tableData},on:{update:function(t){return e.$refs.table.init()}}}),r("AuthForm",{ref:"AuthForm",attrs:{treeData:e.tableData,type:"post"}})],1)},n=[],s=r("1da1"),i=r("5530"),o=(r("96cf"),r("4e82"),r("0897")),l=r("b15a"),c=r("f477"),u=r("70e5"),d=r("3074"),f=r("2f62"),m={components:{listForm:o["default"],AuthForm:u["default"]},data:function(e){this.$createElement;return{columns:[{prop:"name",label:"名称"},{prop:"flag",label:"类型",render:function(t,r){return t("span",[1==r.flag&&t("el-tag",{attrs:{size:e.size,type:"primary"}},[c["a"].getDictLabel("sys_company_flag",1)]),2==r.flag&&t("el-tag",{attrs:{size:e.size,type:"success"}},[c["a"].getDictLabel("sys_company_flag",2)]),3==r.flag&&t("el-tag",{attrs:{size:e.size,type:"info"}},[c["a"].getDictLabel("sys_company_flag",3)])])}},{prop:"useable",sortable:!0,label:"是否启用",render:function(t,r){return 1!=r.flag&&t("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949",value:1==r.useable,size:e.size},on:{change:function(){return e.changeUse(r)}}})}},{prop:"sort",label:"排序",render:function(e,t){return 1!=t.flag&&e("span",[t.sort])}},{label:"操作",headerAlign:"center",fixed:"right",align:"right",width:300,render:function(t,r,a){return t("div",[t("el-button",{attrs:{icon:" kr-tianxie krIconfont",size:e.size,type:"text"},on:{click:function(){return e.edit(r,a)}}},["编辑"]),(1==r.flag||2==r.flag)&&t("el-button",{attrs:{icon:"krIconfont kr-add-circle",size:e.size,type:"text"},on:{click:function(){return e.addChildOffice(r,a)}}},["添加部门"]),2==r.flag&&t("el-button",{attrs:{icon:"krIconfont kr-add-circle",size:e.size,type:"text"},on:{click:function(){return e.addChildPost(r,a)}}},["添加岗位"]),3==r.flag&&t("el-button",{on:{click:function(){return e.authInit(r)}},attrs:{icon:"krIconfont kr-quanxian",type:"text",size:e.size}},["权限分配"]),1!=r.flag&&t("el-button",{attrs:{icon:" kr-shanchu krIconfont",size:e.size,type:"text"},on:{click:function(){return e.del(r,a)}},style:"color:red"},["删除"])])}}],selection:[],searchParams:{companyId:""},tableData:[],companyId:0,showUserCompanyTree:!1,companyTree:[],treeProps:{children:"children",label:"name",disabled:function(e,t){return!e.clickable}}}},created:function(){this.companyId=this.$store.state.user.user.companyId,this.searchParams.companyId=this.$store.state.user.user.companyId,this.getUserClickTree()},computed:Object(i["a"])(Object(i["a"])({},Object(f["c"])({size:function(e){return e.config.defaultSize},user:function(e){return e.user.user}})),{},{getTree:function(){return d["a"].tree}}),methods:{authInit:function(e){this.$refs.AuthForm.init(e.id)},changeCompany:function(e){this.companyId=e.id,this.searchParams.companyId=e.id,this.$refs.table.init()},getUserClickTree:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l["a"].userCompanyTree();case 2:r=t.sent,a=r.data,e.companyTree=[a.data],e.showUserCompanyTree=!0;case 6:case"end":return t.stop()}}),t)})))()},getData:function(e){this.tableData=e},changeUse:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.useable=0==e.useable?"1":"0",r.next=3,d["a"].use({flag:e.flag,orgId:String(e.id),useable:e.useable});case 3:if(a=r.sent,n=a.data,0==n.code){r.next=7;break}return r.abrupt("return",t.$message.error(n.msg));case 7:t.$refs.table.init(),t.$message.success(n.msg);case 9:case"end":return r.stop()}}),r)})))()},addChildOffice:function(e){this.$refs.listForm.init("addChildOffice",e.id,e)},addChildPost:function(e){this.$refs.listForm.init("addChildPost",e.id,e)},addChild:function(e){this.$refs.listForm.init("addChild",e.id,e)},handleSelectionChange:function(e){this.selection=e},add:function(){this.$refs.listForm.init("add")},edit:function(e){this.$refs.listForm.init("edit",e.id,e)},del:function(e){var t=this;this.$confirm("确定要删除选择项？","提示",{confirmButtonText:"删除",cancelButtonText:"取消",type:"error"}).then(Object(s["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,d["a"].del({orgId:e.id,flag:e.flag});case 2:if(a=r.sent,n=a.data,0==n.code){r.next=6;break}return r.abrupt("return",t.$message.error(n.msg));case 6:t.$message.success(n.msg),t.$refs.table.init();case 8:case"end":return r.stop()}}),r)})))).catch((function(e){e.type}))}}},p=m,b=(r("814b"),r("2877")),h=Object(b["a"])(p,a,n,!1,null,"6a4eb555",null);t["default"]=h.exports},"814b":function(e,t,r){"use strict";r("f5c5")},d4ec:function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.d(t,"a",(function(){return a}))},eb40:function(e,t,r){"use strict";var a=r("7bc1");t["a"]={save:function(e){return a["a"].post("/sys/roleAdmin/save",e)},detail:function(e){return a["a"].get("/sys/roleAdmin/queryById",e)},getMenus:function(e){return a["a"].get("/sys/roleAdmin/queryBindMenus",e)},list:function(e){return a["a"].post("/sys/roleAdmin/list",e)},del:function(e){return a["a"].get("/sys/roleAdmin/delete",e)},saveMenus:function(e){return a["a"].post("/sys/roleAdmin/bindMenu",e)}}},f5c5:function(e,t,r){}}]);