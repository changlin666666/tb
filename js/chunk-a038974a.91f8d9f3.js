(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a038974a"],{"0918":function(e,t,r){"use strict";r("a30e")},"5d0f":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{class:e.source.config.fullscreen?"fullscreen":"",attrs:{visible:e.visible,fullscreen:e.source.config.fullscreen,width:e.source.config.width||"50%",title:e.title},on:{"update:visible":function(t){e.visible=t},close:function(t){e.visible=!1}}},[e.visible&&e.showForm?r("myFormDetail",{ref:"form",attrs:{readOnly:"view"==e.method,value:e.initData,data:e.source,rules:e.remoteRules,method:e.method}}):e._e(),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取 消")]),"view"!=e.method?r("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")]):e._e()],1)],1)},n=[],o=r("1da1"),i=r("5530"),s=r("b85c"),c=(r("159b"),r("a15b"),r("96cf"),r("d48d")),u=r("4152"),l=r("9fcf"),d=r("d4ec"),f=r("ade3"),m=function e(){Object(d["a"])(this,e),Object(f["a"])(this,"data",{}),Object(f["a"])(this,"dataId",null),Object(f["a"])(this,"formCode",null),Object(f["a"])(this,"formId",null),Object(f["a"])(this,"processId",null)},h=r("2f62"),b={components:{myFormDetail:c["default"]},props:{width:{type:String,default:"50%"},fullscreen:{type:Boolean,default:!1}},data:function(){return{visible:!1,method:"",form:new m,rules:[],initData:{},id:"",title:"",hasChildren:!1,source:{config:{},rules:[],list:[]},childrenFormData:[],structSource:[],showForm:!1}},mounted:function(){var e=this;this.createForm(),this.$EventBus.$on("submitChildForm",(function(t){e.childrenFormData.push(t)}))},watch:{"$route.fullPath":function(){this.reload()}},computed:{remoteRules:function(){if(this.source.rules&&this.source.rules.length>0){var e,t=[],r=Object(s["a"])(this.source.rules);try{for(r.s();!(e=r.n()).done;){var a=e.value,n={};n.field=a.field,n.control=[{value:a.value,way:a.way,rule:{operator:a.remoteAction,field:a.remoteField}}],t.push(n)}}catch(o){r.e(o)}finally{r.f()}return t}return[]}},methods:Object(i["a"])(Object(i["a"])({init:function(e,t){var r=this;this.loading=!1,this.method=e,this.childrenFormData=[],this.title="add"===e?"新建":"edit"==e?"编辑":"查看",this.id=t,this.form=new m,this.$nextTick(Object(o["a"])(regeneratorRuntime.mark((function a(){var n,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if("add"===e){a.next=8;break}return a.next=3,l["a"].detail({formId:r.$route.query.formId,dataId:t});case 3:n=a.sent,o=n.data,r.initData=o.data,a.next=9;break;case 8:r.initData={};case 9:r.visible=!0,r.showForm=!0,r.$refs.form.resetForm();case 12:case"end":return a.stop()}}),a)}))))}},Object(h["b"])({reload:"common/reload"})),{},{createForm:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,u["a"].getStruct({id:e.$route.query.formId});case 2:r=t.sent,a=r.data,e.source=JSON.parse(a.data.structContent),e.structSource=a.data.children,e.generateModel(e.source.list),e.$emit("config",e.source);case 8:case"end":return t.stop()}}),t)})))()},generateModel:function(e){var t,r=this,a=Object(s["a"])(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;if("remote_table"==n.type){var o,i=Object(s["a"])(this.structSource);try{for(i.s();!(o=i.n()).done;){var c=o.value;n.options.formId==c.formId&&(this.hasChildren=!0,n.options.source=JSON.parse(c.structContent))}}catch(u){i.e(u)}finally{i.f()}}"grid"==n.type?n.columns.forEach((function(e){r.generateModel(e.list)})):"tabs"==n.type?n.tabs.forEach((function(e){r.generateModel(e.list)})):"grid-table"===n.type?n.rows.forEach((function(e){r.generateModel(e.columns)})):"td"===n.type?this.generateModel(n.list):"report"==n.type&&n.rows.forEach((function(e){e.columns.forEach((function(e){r.generateModel(e.list)}))}))}}catch(u){a.e(u)}finally{a.f()}},submit:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,a,n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,r=!0,t.next=4,e.$refs.form.getData();case 4:if(a=t.sent,!e.hasChildren){t.next=10;break}return e.form.children={},window.dispatchEvent(new CustomEvent("getchildFormData")),t.next=10,e.$EventBus.$on("getchildFormData",(function(t){if(t){var n=[];for(var o in t){var i={};t[o].id&&n.push(t[o].id),i[o]=n.join(","),a=Object.assign(a,i)}e.form.children=Object.assign(e.form.children,t)}else r=!1}));case 10:if(r){t.next=12;break}return t.abrupt("return");case 12:for(n in a)"null"==a[n]&&delete a[n];if(e.form.data=a,e.form.formId=e.$route.query.formId,e.loading=!0,o=null,"add"!=e.method){t.next=23;break}return t.next=20,l["a"].add(e.form);case 20:o=t.sent,t.next=28;break;case 23:return e.form.dataId=e.form.data.id,delete e.form.data.id,t.next=27,l["a"].save(e.form);case 27:o=t.sent;case 28:if(0==o.data.code){t.next=30;break}return t.abrupt("return",e.$message.error(o.data.msg));case 30:e.$message.success(o.data.msg),e.$parent.$refs.table.init(),e.loading=!1,e.visible=!1,t.next=40;break;case 36:t.prev=36,t.t0=t["catch"](0),console.log(t.t0),e.loading=!1;case 40:case"end":return t.stop()}}),t,null,[[0,36]])})))()}})},v=b,p=(r("0918"),r("2877")),g=Object(p["a"])(v,a,n,!1,null,"e1c4d10a",null);t["default"]=g.exports},a30e:function(e,t,r){}}]);