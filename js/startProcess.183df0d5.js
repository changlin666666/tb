(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["startProcess"],{"5fd2":function(t,e,n){},"83bb":function(t,e,n){"use strict";n.d(e,"I",(function(){return i})),n.d(e,"w",(function(){return o})),n.d(e,"l",(function(){return a})),n.d(e,"o",(function(){return s})),n.d(e,"K",(function(){return u})),n.d(e,"F",(function(){return c})),n.d(e,"g",(function(){return f})),n.d(e,"p",(function(){return d})),n.d(e,"L",(function(){return l})),n.d(e,"f",(function(){return p})),n.d(e,"G",(function(){return m})),n.d(e,"z",(function(){return g})),n.d(e,"A",(function(){return h})),n.d(e,"r",(function(){return v})),n.d(e,"B",(function(){return y})),n.d(e,"J",(function(){return b})),n.d(e,"b",(function(){return w})),n.d(e,"y",(function(){return x})),n.d(e,"t",(function(){return k})),n.d(e,"N",(function(){return D})),n.d(e,"D",(function(){return j})),n.d(e,"i",(function(){return O})),n.d(e,"n",(function(){return C})),n.d(e,"u",(function(){return R})),n.d(e,"c",(function(){return E})),n.d(e,"j",(function(){return K})),n.d(e,"O",(function(){return F})),n.d(e,"q",(function(){return S})),n.d(e,"a",(function(){return L})),n.d(e,"h",(function(){return $})),n.d(e,"M",(function(){return P})),n.d(e,"e",(function(){return _})),n.d(e,"Q",(function(){return A})),n.d(e,"m",(function(){return I})),n.d(e,"C",(function(){return V})),n.d(e,"x",(function(){return B})),n.d(e,"d",(function(){return U})),n.d(e,"P",(function(){return q})),n.d(e,"k",(function(){return M})),n.d(e,"v",(function(){return N})),n.d(e,"s",(function(){return T})),n.d(e,"E",(function(){return G})),n.d(e,"H",(function(){return J}));var r=n("7bc1"),i=function(t){return r["a"].post("/processDefinition/model/save",t)},o=function(t){return r["a"].post("/processDefinition/model/list",t)},a=function(t){return r["a"].post("/processDefinition/model/delete",t,!0)},s=function(t){return r["a"].post("/processDefinition/deploy",t,!0)},u=function(t){return r["a"].post("/instance/start",t)},c=function(t){return r["a"].post("/task/todo/list",t)},f=function(t){return r["a"].post("/task/complete",t)},d=function(t){return r["a"].post("/task/end/task",t)},l=function(t){return r["a"].post("/task/turnTask",t)},p=function(t){return r["a"].post("/task/back/task",t)},m=function(t){return r["a"].post("/copy/insert",t)},g=function(t){return r["a"].post("/history/process/mys",t)},h=function(t){return r["a"].get("/task/get/nodeList",t)},v=function(t){return r["a"].post("/history/current/list",t)},y=function(t){return r["a"].get("/workflow/setting/list/processDefinitionId",t)},b=function(t){return r["a"].post("/workflow/setting/saveAll",t)},w=function(t){return r["a"].post("/workflow/draft/add",t)},x=function(t){return r["a"].get("/workflow/draft/list",t)},k=function(t){return r["a"].get("/workflow/draft/id?id="+t)},D=function(t){return r["a"].post("/workflow/draft/update",t)},j=function(t){return r["a"].post("/processDefinition/deployment",t)},O=function(t){return r["a"].post("/workflow/draft/delete",t,!0)},C=function(t){return r["a"].post("/instance/delete/processInstance/id",t,!0)},R=function(t){return r["a"].get("/actExtensionCondition",t)},E=function(t){return r["a"].post("/actExtensionCondition/add",t)},K=function(t){return r["a"].post("/actExtensionCondition/delete",t,!0)},F=function(t){return r["a"].post("/actExtensionCondition/update",t)},S=function(t){return r["a"].get("/actExtensionButton/list",t)},L=function(t){return r["a"].post("/actExtensionButton",t)},$=function(t){return r["a"].post("/actExtensionButton/delete",t,!0)},P=function(t){return r["a"].post("/actExtensionButton/update",t)},_=function(t){return r["a"].post("/actExtensionCategory/add",t)},A=function(t){return r["a"].post("/actExtensionCategory/update",t)},I=function(t){return r["a"].post("/actExtensionCategory/delete",t,!0)},V=function(t){return r["a"].get("/actExtensionCategory/list",t)},B=function(t){return r["a"].get("/listener/list",t)},U=function(t){return r["a"].post("/listener/add",t)},q=function(t){return r["a"].post("/listener/update",t)},M=function(t){return r["a"].post("/listener/delete",t,!0)},N=function(t){return r["a"].get("/history/get/instance/id",t)},T=function(t){return r["a"].post("/copy/list",t)},G=function(t){return r["a"].post("/history/all/user",t)},J=function(t){return r["a"].post("/processDefinition/suspend/id",t,!0)}},bb9f:function(t,e,n){"use strict";n("5fd2")},fa30:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"task-container"},[n("KrPanel",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"common-shadow",attrs:{title:"【"+t.$route.query.name+"】內容填写"}},[n("ProForm",{ref:"form",attrs:{rules:t.remoteRules,data:t.formData,entity:t.formValue},on:{"update:entity":function(e){t.formValue=e}}})],1),n("KrPanel",{staticClass:"common-shadow",staticStyle:{"margin-top":"20px"},attrs:{title:"抄送信息"}},[n("el-form",{ref:"ruleForm",attrs:{"label-width":"140px",model:t.ruleForm}},[n("el-form-item",{attrs:{label:"标题",prop:"title"}},[n("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.ruleForm.title,callback:function(e){t.$set(t.ruleForm,"title",e)},expression:"ruleForm.title"}})],1),n("el-form-item",{attrs:{label:"抄送"}},[n("KrUserSelect",{staticStyle:{width:"400px"},model:{value:t.cc,callback:function(e){t.cc=e},expression:"cc"}})],1)],1)],1),n("KrPanel",{staticClass:"common-shadow",staticStyle:{"margin-top":"20px","margin-bottom":"60px"},attrs:{title:"审核人"}},[n("kr-time-line",t._l(t.processList,(function(e,r){return n("kr-time-line-item",{key:r,attrs:{icon:"krIconfont kr-shenhe",text:"审批"}},[n("div",{staticStyle:{"font-weight":"700"}},[t._v(" "+t._s(e.name)+" ")]),n("div",{staticClass:"m-t-20",staticStyle:{display:"flex","align-items":"center","justify-content":"start"}},t._l(e.candidateUsers,(function(e,r){return n("div",{key:r,staticStyle:{display:"flex","align-items":"center","flex-flow":"column","margin-right":"20px"}},[n("div",[n("img",{staticClass:"user-img",attrs:{src:t.getAvatar(e),alt:""}})]),n("div",{staticStyle:{"text-align":"center"}},[t._v(t._s(e.name))])])})),0)])})),1)],1),n("el-card",{staticClass:"submit-buttons"},[n("el-button",{attrs:{plain:""},on:{click:t.cancel}},[t._v("取消返回")]),n("el-button",{attrs:{type:"primary"},on:{click:t.start}},[t._v("提交")]),n("el-button",{attrs:{type:"danger"},on:{click:t.saveDraft}},[t._v("保存草稿")])],1)],1)},i=[],o=n("1da1"),a=n("b85c"),s=n("5530"),u=(n("96cf"),n("99af"),n("b0c0"),n("d81d"),n("a15b"),n("83bb")),c=n("4152"),f=n("2f62"),d=n("d48d"),l=n("0ac7"),p=n.n(l),m={components:{ProForm:d["default"]},name:"startProcess",data:function(){return{ruleForm:{isNextHandler:!1,nextAssigne:"",comment:"",title:""},id:"",processDefinitionKey:"",cc:[],formData:{},initData:{},formSetList:[],startEvent:{},loading:!1,formValue:{},assigneeList:"",processList:[],defaultAvatar:p.a}},computed:Object(s["a"])(Object(s["a"])({},Object(f["c"])({user:function(t){return t.user.user}})),{},{remoteRules:function(){if(this.formData.rules&&this.formData.rules.length>0){var t,e=[],n=Object(a["a"])(this.formData.rules);try{for(n.s();!(t=n.n()).done;){var r=t.value,i={};i.field=r.field,i.control=[{value:r.value,way:r.way,rule:{operator:r.remoteAction,field:r.remoteField}}],e.push(i)}}catch(o){n.e(o)}finally{n.f()}return e}return[]}}),mounted:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.id=t.$route.query.id,t.loading=!0,t.processDefinitionKey=t.$route.query.processDefinitionKey,t.ruleForm.title="".concat(t.user.name," 在 ").concat(t.$dayjs(new Date).format("YYYY-MM-DD HH:mm:ss")," 发起了【").concat(t.$route.query.name,"】"),e.next=6,t.getProcessFormSetList();case 6:n=[],t.formSetList.map((function(e){(e.candidateGroups||e.candidateUsers)&&(e.candidateGroups&&n.push(e.candidateGroups),e.candidateUsers&&n.push(e.candidateUsers)),"bpmn:StartEvent"===e.settingType&&(e.fieldPermission=JSON.parse(e.fieldPermission),t.startEvent=e,t.getFormConfig(e.formKey))})),t.assigneeList=n.join(","),t.loading=!1;case 10:case"end":return e.stop()}}),e)})))()},methods:Object(s["a"])(Object(s["a"])({},Object(f["b"])({delVisitedRoute:"tagsview/delVisitedRoute"})),{},{start:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$refs.form.getData().then(function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(n){var r,i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.getConditonPrams(n),e.next=3,Object(u["K"])({dataMap:n,deplymentId:t.id,nextAssigne:"",variables:Object(s["a"])({title:t.ruleForm.title},r)});case 3:i=e.sent,o=i.data,0===o.code&&(t.$message.success("提交成功"),t.processCC(o.data),setTimeout((function(){t.delVisitedRoute({route:t.$route,self:t})})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))()},processCC:function(t){this.cc.length&&Object(u["G"])({copyAuthor:this.user.id,createTime:"",taskDefinitionKey:this.startEvent.taskDefKey,processDefinitionKey:t.processDefinitionKey,processInstanceId:t.processInstanceId,processTitle:this.ruleForm.title,processName:this.$route.query.name,userId:this.cc.join()})},getFormConfig:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var r,i,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t){n.next=3;break}return e.formData={},n.abrupt("return");case 3:return n.next=5,Object(c["b"])({id:t});case 5:r=n.sent,i=r.data,0===i.code&&(o=JSON.parse(i.data.structContent),e.formData=o,e.startEvent.fieldPermission.map((function(t){e.formData.list.map((function(e){e.model===t.model&&(t.readable||(e.hidden=!0),!t.writable&&t.readable&&(e.options.disabled=!0))}))})));case 8:case"end":return n.stop()}}),n)})))()},getProcessFormSetList:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.formSetList=[],e.next=3,Object(u["B"])({processDefinitionKey:t.processDefinitionKey});case 3:n=e.sent,r=n.data,0===r.code&&(t.formSetList=r.data);case 6:case"end":return e.stop()}}),e)})))()},getReviewers:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var r,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(u["E"])({key:e.processDefinitionKey,variableMap:Object(s["a"])({assigneeList:e.assigneeList},t)});case 2:r=n.sent,i=r.data,0===i.code&&(e.processList=i.data);case 5:case"end":return n.stop()}}),n)})))()},saveDraft:function(){var t=this;this.$refs.form.getData().then(function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(n){var r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(u["b"])({dataMap:n,formKey:t.startEvent.formKey,processDefinitionKey:t.processDefinitionKey,title:t.ruleForm.title,userId:t.user.id,copyUser:t.cc.join()});case 2:r=e.sent,i=r.data,0===i.code&&(t.$message.success("保存草稿成功"),setTimeout((function(){t.delVisitedRoute({route:t.$route,self:t})})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},getConditonPrams:function(t){var e={};return this.startEvent.fieldPermission.map((function(n){n.process&&(e[n.model]=t[n.model])})),e},cancel:function(){this.delVisitedRoute({route:this.$route,self:this}),this.$router.push({path:"/pages/process-design/processList"})},getAvatar:function(t){return t&&t.avatar?this.$BASE_URL+"/source/download?id="+t.avatar:this.defaultAvatar}}),watch:{formValue:{deep:!0,handler:function(t){this.getReviewers(t)}}}},g=m,h=(n("bb9f"),n("2877")),v=Object(h["a"])(g,r,i,!1,null,"ddaa740a",null);e["default"]=v.exports}}]);