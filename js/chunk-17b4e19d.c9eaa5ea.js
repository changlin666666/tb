(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-17b4e19d","chunk-7f9fd001"],{"0773":function(e,t,r){},2668:function(e,t,r){},"534b":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"notification"},[r("div",{staticClass:"content-header"},[r("el-form",{ref:"elForm",staticClass:"filter-form",attrs:{inline:!0,model:e.searchForm}},[r("el-form-item",[r("el-input",{attrs:{placeholder:"通知名称",clearable:""},model:{value:e.searchForm.title,callback:function(t){e.$set(e.searchForm,"title",t)},expression:"searchForm.title"}})],1),r("el-form-item",[r("el-select",{attrs:{placeholder:"类型",clearable:""},model:{value:e.searchForm.type,callback:function(t){e.$set(e.searchForm,"type",t)},expression:"searchForm.type"}},e._l(e.getDictList("news_type").filter((function(e){return 2!=e.code})),(function(e){return r("el-option",{key:e.code,attrs:{label:e.value,value:e.code}})})),1)],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.doSearch}},[e._v("查询")]),r("el-button",{attrs:{icon:"el-icon-refresh-right"},on:{click:e.resetParams}},[e._v("重置")])],1)],1)],1),r("div",{staticClass:"table"},[r("kr-table",{ref:"table",attrs:{columns:e.columns,fetchFunc:e.getList,searchParams:e.searchForm},on:{"selection-change":e.handleSelectionChange}},[r("div",{attrs:{slot:"handleButtons"},slot:"handleButtons"},[r("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.addOrEdit("add")}}},[e._v("新增公告")]),r("el-button",{attrs:{type:"danger",plain:"",icon:"el-icon-delete",disabled:0==e.selectedRows.length},on:{click:function(t){return e.del(e.selectedRows)}}},[e._v("批量删除"+e._s(e.selectedRows.length?"("+e.selectedRows.length+")":""))])],1)])],1),r("formDialog",{ref:"form"})],1)},a=[],i=r("1da1"),o=r("5530"),s=(r("96cf"),r("a15b"),r("d81d"),r("9fac")),c=r("96e6"),l=r("f477"),u=r("2f62"),f={name:"sys-notification",components:{formDialog:s["default"]},props:{},data:function(){this.$createElement;var e=this;return{notiType:[],searchForm:{title:"",type:""},selectedRows:[],total:100,rows:[],columns:[{prop:"title",label:"公告标题",render:function(e,t){return e("div",{style:"color:var(--defaultTheme)"},[t.title])}},{prop:"createUserName",sortable:!0,label:"发布人"},{prop:"type",label:"公告类型",sortable:!0,render:function(e,t){return e("div",{style:"display:inline-block;padding: 4px 12px;border-radius: 16px;background:#f3f4f8;color:#a3a4b5"},[l["a"].getDictLabel("news_type",t.type)])}},{prop:"notifyRecordList",label:"通知范围",render:function(e,t){return e("div",{style:"color:var(--defaultTheme)"},[t.notifyRecordList.map((function(e){return e.userName})).join(",")])}},{prop:"publishTime",label:"发布时间",sortable:!0,width:"300"},{prop:"status",label:"状态",render:function(e,t){return e("div",[0===t.status&&e("el-tag",[l["a"].getDictLabel("news_status",t.status)]),1===t.status&&e("el-tag",{attrs:{type:"success"}},[l["a"].getDictLabel("news_status",t.status)])])}},{label:"操作",headerAlign:"center",prop:"ffff",width:120,fixed:"right",align:"right",render:function(t,r){return t("div",[t("el-button",{on:{click:function(){return e.addOrEdit("view",r)}},attrs:{type:"text",size:e.size,icon:"krIconfont kr-icon_yulan"}},["查看"]),0===r.status&&t("el-button",{attrs:{size:e.size,icon:"krIconfont kr-tianxie",type:"text"},on:{click:function(){return e.addOrEdit("edit",r)}}},["编辑"]),0===r.status&&t("el-button",{attrs:{size:e.size,icon:"krIconfont kr-icon_fabu",type:"text"},on:{click:function(){return e.publicNotification(r)}}},["发布"]),t("el-button",{attrs:{size:e.size,icon:" kr-shanchu krIconfont",type:"text"},on:{click:function(){return e.del(r)}},style:"color:red"},["删除"])])}}],showDetail:!1}},computed:Object(o["a"])(Object(o["a"])({},Object(u["c"])({size:function(e){return e.config.defaultSize}})),{},{getList:function(){return c["a"].list}}),watch:{},created:function(){},mounted:function(){},methods:{resetParams:function(){this.searchForm={title:"",type:""},this.doSearch()},doSearch:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.table.insidePage=1,e.$refs.table.init();case 2:case"end":return t.stop()}}),t)})))()},addOrEdit:function(e,t){this.$refs.form.init(e,t)},handleSelectionChange:function(e){this.selectedRows=e},del:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e instanceof Array||(e=[e]),0!=e.length){r.next=3;break}return r.abrupt("return",t.$message.error("请选择需要删除的项!"));case 3:t.$confirm("此操作将永久删除所选, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.map((function(e){return e.id})),r.next=3,c["a"].del({ids:n});case 3:if(a=r.sent,i=a.data,0==i.code){r.next=7;break}return r.abrupt("return",t.$message.error(i.msg));case 7:t.$message({type:"success",message:"删除成功!"}),t.doSearch();case 9:case"end":return r.stop()}}),r)})))).catch((function(){t.$message({type:"info",message:"已取消删除"})}));case 4:case"end":return r.stop()}}),r)})))()},getDictList:function(e){return l["a"].getDictList(e)},cancelNotification:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.status=0,r.next=3,c["a"].save({id:e.id});case 3:n=r.sent,a=n.data,0==a.code&&(t.$message.success("发布成功！"),t.doSearch()),t.$message.success("撤销成功！"),t.doSearch();case 8:case"end":return r.stop()}}),r)})))()},publicNotification:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.status=1,r.next=3,c["a"].publish({id:e.id});case 3:n=r.sent,a=n.data,0==a.code&&(t.$message.success("发布成功！"),t.doSearch());case 6:case"end":return r.stop()}}),r)})))()}}},d=f,m=(r("7e8d"),r("2877")),p=Object(m["a"])(d,n,a,!1,null,"bcd51c70",null);t["default"]=p.exports},"6ad9":function(e,t,r){},"7e8d":function(e,t,r){"use strict";r("6ad9")},"9fac":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{visible:e.visible,title:"通知管理",width:"80%"},on:{"update:visible":function(t){e.visible=t},close:e.close}},["view"!=e.method?r("div",{staticClass:"form-page"},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"7em",disabled:"view"==e.method},on:{validate:e.formValidated}},[r("el-form-item",{attrs:{label:"通知标题：",prop:"title"}},[r("el-input",{attrs:{placeholder:"请输入通知标题",clearable:""},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),r("div",{staticClass:"inline"},[r("el-form-item",{attrs:{label:"通知类型：",prop:"type"}},[r("el-select",{attrs:{placeholder:"请选择通知类型",clearable:""},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.getDictList("news_type").filter((function(e){return 2!=e.code})),(function(e){return r("el-option",{key:e.code,attrs:{label:e.value,value:e.code}})})),1)],1),r("el-form-item",{attrs:{label:"通知范围：",prop:"notifyRecordIds"}},[r("el-radio-group",{model:{value:e.form.fullFlag,callback:function(t){e.$set(e.form,"fullFlag",t)},expression:"form.fullFlag"}},[r("el-radio-button",{attrs:{label:1}},[e._v("全员")]),r("el-radio-button",{attrs:{label:0}},[e._v("指定人员")])],1),0==e.form.fullFlag?r("userSelect",{model:{value:e.form.notifyRecordIds,callback:function(t){e.$set(e.form,"notifyRecordIds",t)},expression:"form.notifyRecordIds"}}):e._e()],1)],1),r("el-form-item",{attrs:{label:"通知内容：",prop:"content"}},[e.visible?r("Editor",{ref:"editor",attrs:{readonly:"view"==e.method,height:500},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}}):e._e()],1),r("el-form-item",{staticStyle:{"text-align":"center"}})],1)],1):r("div",{staticClass:"el-dialog-div"},[r("p",{staticClass:"noti-title"},[e._v(e._s(e.form.title))]),r("div",{staticClass:"desc"},[r("span",[e._v("发布时间："+e._s(e.form.createTime))]),r("span",[e._v("发布人："+e._s(e.form.createUserName))]),r("span",[e._v("公告类型："+e._s(e.dictUtils.getDictLabel("news_type",e.form.type)))])]),r("p",{domProps:{innerHTML:e._s(e.form.content)}})]),"view"==e.method?r("el-form",{attrs:{model:e.form,rules:e.rules,"label-width":"7em"},on:{validate:e.formValidated}},["view"==e.method&&e.form.notifyRecordList.length>0?r("el-form-item",{attrs:{label:"阅读列表"}},[r("el-table",{attrs:{data:e.form.notifyRecordList}},[r("el-table-column",{attrs:{label:"接收人",prop:"userName"}}),r("el-table-column",{attrs:{label:"阅读状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tag",{attrs:{type:t.row.readFlag?"success":"primary"}},[e._v(e._s(t.row.readFlag?"已读":"未读"))])]}}],null,!1,965423750)}),r("el-table-column",{attrs:{label:"阅读时间",prop:"readDate"}})],1)],1):e._e()],1):e._e(),"view"!=e.method?r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.close}},[e._v("取 消")]),r("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{type:"warning"},on:{click:function(t){return e.validForm(0)}}},[e._v(e._s("add"==e.method?"新增草稿":"保存草稿"))]),r("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{type:"primary"},on:{click:function(t){return e.validForm(1)}}},[e._v("立即发布")])],1):e._e()],1)},a=[],i=r("1da1"),o=(r("96cf"),r("f477")),s=r("9f0d"),c=r("d4ec"),l=r("ade3"),u=function e(){Object(c["a"])(this,e),Object(l["a"])(this,"content",""),Object(l["a"])(this,"files",""),Object(l["a"])(this,"id",""),Object(l["a"])(this,"notifyRecordIds",[]),Object(l["a"])(this,"notifyRecordList",[]),Object(l["a"])(this,"fullFlag",1),Object(l["a"])(this,"status",""),Object(l["a"])(this,"title",""),Object(l["a"])(this,"type","")},f=r("96e6"),d={components:{userSelect:s["a"]},props:{},data:function(){return{dictUtils:o["a"],visible:!1,data:null,form:new u,userIds:[],rules:{title:{required:!0,message:"请输入通知标题",trigger:"blur"},type:{required:!0,message:"请选择通知类型",trigger:"blur"},content:{required:!0,message:"请输入通知内容",trigger:"blur"}},method:""}},computed:{},watch:{"form.fullFlag":{handler:function(e){0==e&&(this.form.notifyRecordIds=[])}}},created:function(){},mounted:function(){},methods:{init:function(e,t){var r=this;this.method=e,this.visible=!0,this.userIds=[],this.from=new u,this.$nextTick(Object(i["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("add"==e){n.next=6;break}return n.next=3,f["a"].detail({id:t.id});case 3:a=n.sent,r.form=a.data.data,r.form.type=String(r.form.type);case 6:case"end":return n.stop()}}),n)}))))},close:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.visible=!1;case 1:case"end":return t.stop()}}),t)})))()},validForm:function(e){var t=this;this.$refs.form.validate(function(){var r=Object(i["a"])(regeneratorRuntime.mark((function r(n){var a,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!n){r.next=13;break}return t.form.status=e,r.next=4,f["a"].save(t.form);case 4:if(a=r.sent,i=a.data,0==i.code){r.next=8;break}return r.abrupt("return",t.$message.error(i.msg));case 8:t.$message.success(i.msg),t.$parent.$refs.table.init(),t.close(),r.next=14;break;case 13:return r.abrupt("return",!1);case 14:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())},formValidated:function(e,t,r){console.log(e,t,r)},getDictList:function(e){return o["a"].getDictList(e)}}},m=d,p=(r("c0a5"),r("ff63"),r("2877")),h=Object(p["a"])(m,n,a,!1,null,"05f650d0",null);t["default"]=h.exports},c0a5:function(e,t,r){"use strict";r("2668")},d4ec:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.d(t,"a",(function(){return n}))},ff63:function(e,t,r){"use strict";r("0773")}}]);