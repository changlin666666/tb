(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3028381a"],{2287:function(t,e,a){"use strict";a("f4cb")},6877:function(t,e,a){},aab2:function(t,e,a){"use strict";a("6877")},b3cf:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"table_box"},[a("el-form",{ref:"tableForm",staticClass:"subTableForm",attrs:{"status-icon":"",model:t.inlineFormData}},[a("el-table",{staticStyle:{width:"calc(100% - 10px)"},attrs:{data:t.subTableForm.tableData,border:"",fit:""}},[a("template",{slot:"empty"},[a("SvgIcon",{staticClass:"empty_icon",attrs:{"icon-class":"table_empty"}}),a("span",[t._v("暂无数据")])],1),a("el-table-column",{attrs:{type:"index",align:"center",label:"#","header-align":"center","min-width":"50"}}),t._l(t.widget.tableColumns,(function(e,n){return a("el-table-column",{key:n,attrs:{"min-width":e.options.width,prop:e.model,label:e.name},scopedSlots:t._u([{key:"default",fn:function(n){return[t.readOnly||"DETAIL"===n.row._mode?[a("span",[t._v(t._s(n.row[e.model]))])]:a("ProFormItem",{staticClass:"form-item",attrs:{remote:t.remote,models:t.inlineFormData,widget:e,readOnly:t.readOnly||"DETAIL"===n.row._mode?{}:null}})]}}],null,!0)})})),t.readOnly?t._e():a("el-table-column",{attrs:{label:"操作","header-align":"center","min-width":"100",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.isEditable(e.row)?t._e():a("el-button",{staticClass:"action-btn",attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.handleEditOnClick(e.row)}}},[t._v("编辑")]),t.isEditable(e.row)?a("el-button",{staticClass:"action-btn",attrs:{btnSaveIsLoading:t.btnSaveIsLoading,type:"success",size:"mini"},on:{click:function(a){return t.handleSaveOnClick(e.row)}}},[t._v("保存")]):t._e(),t.isEditable(e.row)?t._e():a("el-button",{staticClass:"action-btn",attrs:{type:"danger",size:"mini"},on:{click:function(a){return t.handleDeleteOnClick(e.row,e.$index)}}},[t._v("删除")]),t.isEditable(e.row)?a("el-button",{staticClass:"action-btn",attrs:{type:"normal",size:"mini"},on:{click:function(a){return t.handleCancelOnClick(e.row,e.$index)}}},[t._v("取消")]):t._e()]}}],null,!1,3081379135)},[a("template",{slot:"header"},[t.readOnly?t._e():a("span",{staticClass:"add-button",on:{click:t.addRow}},[a("i",{staticClass:"el-icon el-icon-plus",attrs:{type:"primary",size:"mini"}}),t._v("添加")])])],2)],2)],1)],1)},i=[],o=a("ade3"),s=a("3835"),l=(a("d3b7"),a("3ca3"),a("ddb0"),a("d81d"),a("a434"),a("159b"),a("b64b"),a("25f0"),a("ba16")),r={name:"SubForm",components:{SvgIcon:l["a"],ProFormItem:function(){return Promise.resolve().then(a.bind(null,"7a19"))}},props:{widget:{type:Object,default:function(){return{tableColumns:[],options:{},model:""}}},remote:{type:Object,default:function(){return{}}},readOnly:{type:Boolean,default:null},models:{type:Object,default:function(){return{}}}},data:function(){return{subTableForm:{tableData:[]},inlineFormData:{},initialData:{},mode:"DETAIL",btnSaveIsLoading:!1}},methods:{isEditable:function(t){return t._mode&&"DETAIL"!==t._mode},addRow:function(){if(console.log(this.subTableForm.tableData),console.log(this.mode),"DETAIL"===this.mode){this.mode="ADD";var t=this.widget.tableColumns.map((function(t){var e;return e={},Object(o["a"])(e,t.model,t.options.defaultValue||""),Object(o["a"])(e,"_mode","ADD"),e})),e=Object(s["a"])(t,1),a=e[0];this.inlineFormData=a,this.subTableForm.tableData.push(a)}else this.$message.warning("请先保存当前数据")},handleDeleteOnClick:function(t,e){var a=this;this.$confirm("确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.subTableForm.tableData.splice(e,1),a.$emit("subFormUpdate",a.subTableForm)})).catch((function(){a.$message.info("已取消删除")}))},handleCancelOnClick:function(t,e){var a=this;"ADD"===t._mode&&this.subTableForm.tableData.splice(e,1),Object.keys(this.initialData).forEach((function(e){t[e]=a.initialData[e]})),t._mode="DETAIL",this.mode="DETAIL",this.inlineFormData=t},handleEditOnClick:function(t){"DETAIL"===this.mode?(t._mode="EDIT",this.mode="EDIT",this.inlineFormData=t,this.initialData=JSON.parse(JSON.stringify(t))):this.$message.warning("请先保存当前数据")},handleSaveOnClick:function(t){var e=this;this.btnSaveIsLoading=!0,this.$refs.tableForm.validate((function(t){if(t){var a=e.inlineFormData;Object.keys(a).forEach((function(t){Array.isArray(a[t])&&(a[t]=a[t].toString())})),a._mode="DETAIL",e.mode="DETAIL",e.$emit("subFormUpdate",e.subTableForm)}else e.$message.warning("表单校验失败")}))}},created:function(){},computed:{},watch:{models:{immediate:!0,deep:!0,handler:function(t){this.models[this.widget.model]?this.subTableForm.tableData=JSON.parse(this.models[this.widget.model]):this.subTableForm.tableData=[]}}}},c=r,d=(a("2287"),a("2877")),u=Object(d["a"])(c,n,i,!1,null,"3415545a",null);e["default"]=u.exports},ba16:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("svg",{class:t.svgClass,attrs:{"aria-hidden":"true"}},[a("use",{attrs:{"xlink:href":t.iconName}})])},i=[],o={name:"SvgIcon",props:{iconClass:{type:String,required:!0},className:{type:String,default:""}},computed:{iconName:function(){return"#icon-".concat(this.iconClass)},svgClass:function(){return this.className?"SvgIcon ".concat(this.className):"SvgIcon"}}},s=o,l=(a("aab2"),a("2877")),r=Object(l["a"])(s,n,i,!1,null,"368d5b56",null);e["a"]=r.exports},f4cb:function(t,e,a){}}]);