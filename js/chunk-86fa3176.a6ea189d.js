(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-86fa3176","chunk-20b6452e","chunk-62060c7e"],{"5bf2":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{visible:e.visible,title:"权限分配",width:e.width},on:{"update:visible":function(t){e.visible=t},close:function(t){e.visible=!1}}},[n("el-table",{attrs:{data:e.tableList,size:"small",border:"","header-cell-style":{background:"#fafafa"}}},[n("el-table-column",{attrs:{label:"权限名称",align:"center",prop:"name"}}),n("el-table-column",{attrs:{label:"权限标识",align:"center",prop:"permission"}}),n("el-table-column",{attrs:{label:"权限开关",prop:"flag",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-switch",{attrs:{value:1==t.row.flag},on:{change:function(n){return e.change(n,t.row,t.$index)}}}),e._v(" "+e._s(t.row.flag?"开启":"关闭")+" ")]}}])})],1)],1)},a=[],s=n("1da1"),i=(n("d81d"),n("4de4"),n("96cf"),n("a211")),o=n("f477"),c=n("6632"),u={components:{},props:{width:{type:String,default:"50%"}},watch:{},data:function(){return{visible:!1,method:"",id:"",title:"",dictUtils:o["a"],disabled:!1,data:[],tableList:[],menuId:"",roleId:""}},computed:{},methods:{init:function(e,t){var n=this;this.roleId=e,this.menuId=t,this.visible=!0,this.$nextTick(Object(s["a"])(regeneratorRuntime.mark((function r(){var a,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,i["a"].getRoleBtn({roleId:e,menuId:t});case 2:a=r.sent,s=a.data,s.data?n.tableList=s.data:n.tableList=[];case 5:case"end":return r.stop()}}),r)}))))},change:function(e,t,n){var r=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r.tableList[n].flag=e,a=r.tableList.filter((function(e){return e.flag})).map((function(e){return e.id})),t.next=4,i["a"].bindBtn({functionIds:a,menuId:r.menuId,roleId:r.roleId});case 4:if(s=t.sent,o=s.data,0==o.code){t.next=8;break}return t.abrupt("return",r.$message.error(o.msg));case 8:r.$message.success(o.msg);case 9:case"end":return t.stop()}}),t)})))()},submit:function(){var e=this;try{this.$refs.form.validate(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(n){var r,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n){t.next=14;break}return e.form.companyId=e.companyId,r=e.form,t.next=5,c["a"].saveRole(r);case 5:if(a=t.sent,s=a.data,0==s.code){t.next=9;break}return t.abrupt("return",e.$message.error(s.msg));case 9:e.$message.success(s.msg),e.$emit("update"),e.visible=!1,t.next=15;break;case 14:return t.abrupt("return",!1);case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}catch(t){this.$message.error(t)}}}},l=u,d=n("2877"),f=Object(d["a"])(l,r,a,!1,null,null,null);t["default"]=f.exports},6632:function(e,t,n){"use strict";n.d(t,"b",(function(){return a}));var r=n("7bc1"),a=function(e){return r["a"].post("/sys/role/list",e)},s=function(e){return r["a"].get("/sys/role/queryById",e)},i=function(e){return r["a"].post("/sys/role/saveRole",e)},o=function(e){return r["a"].post("/sys/role/delete",e)},c=function(e){return r["a"].get("/sys/role/useableList",e)},u=function(e){return r["a"].post("/sys/bind/queryBindRoles",e)};t["a"]={getRoleList:a,getRoleByID:s,saveRole:i,deleteRoleByID:o,useableList:c,userRoleList:u,use:function(e){return r["a"].get("/sys/role/enableRole",e)}}},"80e4":function(e,t,n){},a211:function(e,t,n){"use strict";var r=n("7bc1");t["a"]={bindBtn:function(e){return r["a"].post("/sys/roleB/bindFunction",e)},bindMenus:function(e){return r["a"].post("/sys/roleB/bindMenu",e)},del:function(e){return r["a"].post("/sys/roleB/delete",e)},getOwnMenus:function(e){return r["a"].post("/sys/roleB/getMenuList",e)},getMenus:function(e){return r["a"].get("/sys/roleB/getMenuTypeTree",e)},getMenusBind:function(e){return r["a"].post("/sys/roleB/queryBindMenus",e)},getRoleBtn:function(e){return r["a"].get("/sys/roleB/queryFunctionList",e)}}},ba4b:function(e,t,n){"use strict";n("80e4")},bb47:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("div",{staticClass:"content"},[n("div",{staticClass:"left-box"},[n("div",{staticClass:"header"},[n("div",[e._v("角色管理("+e._s(e.leftList.length)+")")]),n("el-tooltip",{attrs:{effect:"dark",content:"添加角色",placement:"top-start"}},[n("el-button",{attrs:{type:"text",icon:"el-icon-plus"},on:{click:e.addRole}})],1)],1),n("div",{staticClass:"left-list"},e._l(e.leftList,(function(t,r){return n("div",{key:r,staticClass:"item",class:e.active==t.id?"active":"",on:{click:function(n){return e.choseRole(t)}}},[n("div",{staticClass:"name textover1"},[n("el-tag",{attrs:{type:t.useable?"primary":"warning",size:"mini"}},[e._v(e._s(t.useable?"可用":"禁用"))]),n("i",{staticClass:"krIconfont kr-hezuohuobanmiyueguanli"}),n("el-tooltip",{attrs:{effect:"dark",content:t.name,placement:"top-start"}},[n("span",[e._v(e._s(t.name))])])],1),n("div",{staticClass:"icon"},[n("el-tooltip",{attrs:{effect:"dark",content:"编辑角色",placement:"top-start"}},[n("i",{staticClass:"el-icon-edit edit",on:{click:function(n){return e.editRole(t)}}})]),n("el-tooltip",{attrs:{effect:"dark",content:"删除角色",placement:"top-start"}},[n("i",{staticClass:"el-icon-delete delete",staticStyle:{color:"red"},on:{click:function(n){return e.delRole(t)}}})])],1)])})),0)]),n("div",{staticClass:"right-box"},[n("div",{staticClass:"top"},[n("kr-panel",{staticClass:"button-panel margin-t-20",attrs:{title:"功能配置"}},[n("div",{staticClass:"menusBox"},[n("kr-table",{ref:"table",attrs:{columns:e.columns,rows:e.tableList,selection:!1,showPagination:!1,getTree:""}})],1)])],1)]),n("div",{staticClass:"right-tree"},[e._m(0),n("div",{staticClass:"tree-content"},[n("div",{staticClass:"tree-btn"},[n("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{type:"primary",size:"medium",disabled:0==e.selection.length},on:{click:e.bindMenus}},[e._v("确认授权")])],1),e.showTree?n("kr-tree",{ref:"tree",staticClass:"tree",attrs:{data:e.treeData,props:e.treeProps,"node-key":"id","show-checkbox":"","default-checked-keys":e.MenusIds,"default-expand-all":!0},on:{check:e.getChecked}}):e._e()],1)])]),n("permissionForm",{ref:"permissionForm"}),n("listForm",{ref:"form",attrs:{companyId:e.companyId},on:{update:e.update}})],1)},a=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"header"},[n("div",[e._v("权限管理")])])}],s=n("2909"),i=n("1da1"),o=n("5530"),c=n("b85c"),u=(n("96cf"),n("caad"),n("2532"),n("d81d"),n("99af"),n("a434"),n("c740"),n("6632")),l=n("a211"),d=n("f477"),f=n("5bf2"),m=n("dffc2"),p=n("2f62");function b(e,t,n){var r,a=Object(c["a"])(e);try{for(a.s();!(r=a.n()).done;){var s=r.value;s.children.length>0?b(s.children,t,n):t.includes(s.id)&&n.push(s)}}catch(i){a.e(i)}finally{a.f()}return n}var h={components:{listForm:m["default"],permissionForm:f["default"]},data:function(e){this.$createElement;return{showRoleForm:!1,tableList:[],companyId:0,showUserCompanyTree:!1,companyTree:[],treeProps:{children:"children",label:"name"},companyProps:{children:"children",label:"name",disabled:function(e,t){return!e.clickable}},showTree:!0,leftList:[],active:0,selection:[],treeData:[],MenusIds:[],columns:[{prop:"name",label:"名称"},{prop:"icon",label:"图标",render:function(e,t){return e("i",{class:t.icon})}},{prop:"type",sortable:!0,label:"类型",render:function(t,n){return t("span",["0"==n.menuType&&t("el-tag",{attrs:{size:e.size,type:"primary"}},[d["a"].getDictLabel("menu_type","0")]),1==n.menuType&&t("el-tag",{attrs:{size:e.size,type:"success"}},[d["a"].getDictLabel("menu_type",1)]),2==n.menuType&&t("el-tag",{attrs:{size:e.size,type:"info"}},[d["a"].getDictLabel("menu_type",2)]),3==n.menuType&&t("el-tag",{attrs:{size:e.size,type:"info"}},[d["a"].getDictLabel("menu_type",3)])])}},{fixed:"right",align:"right",width:200,render:function(t,n){return t("div",[t("el-button",{attrs:{type:"text",size:e.size,icon:"el-icon-delete"},style:"color:red",on:{click:function(){return e.del(n)}}},["删除"]),1==n.flag&&t("el-button",{attrs:{type:"text",icon:"krIconfont kr-quanxian",size:e.size},on:{click:function(){return e.permission(n)}}},["权限分配"])])}}]}},computed:Object(o["a"])({MenusList:function(){var e=[];return b(this.treeData,this.MenusIds,e),e}},Object(p["c"])({size:function(e){return e.config.defaultSize}})),mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.companyId=e.$store.state.user.user.companyId,t.next=3,e.init();case 3:e.getMenus();case 4:case"end":return t.stop()}}),t)})))()},watch:{MenusIds:{immediate:!0,handler:function(e){this.selection=e}}},methods:{update:function(){this.init(!0)},editRole:function(e){this.$refs.form.init("edit",e.id,e)},delRole:function(e){var t=this;if(e instanceof Array||(e=[e]),0==e.length)return this.$message.error("请选择需要删除的项!");this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.map((function(e){return e.id})),n.next=3,l["a"].del({ids:r});case 3:if(a=n.sent,s=a.data,0==s.code){n.next=7;break}return n.abrupt("return",t.$message.error(s.msg));case 7:t.$message.success(s.msg),t.init();case 9:case"end":return n.stop()}}),n)})))).catch((function(){}))},addRole:function(){this.$refs.form.init("add")},getMenus:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l["a"].getMenus({type:1});case 2:n=t.sent,r=n.data,e.treeData=r.data.children;case 5:case"end":return t.stop()}}),t)})))()},init:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,u["a"].getRoleList({current:1,size:9999,companyId:t.companyId});case 2:r=n.sent,a=r.data,t.leftList=a.data.records,e||(t.active=t.leftList[0].id),t.getOwnMenus(),t.getMenusBind();case 8:case"end":return n.stop()}}),n)})))()},getChecked:function(e,t){this.selection=[].concat(Object(s["a"])(t.checkedKeys),Object(s["a"])(t.halfCheckedKeys))},choseRole:function(e){this.active=e.id,this.getOwnMenus(),this.getMenusBind()},getOwnMenus:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l["a"].getOwnMenus({roleId:e.active,type:1});case 2:n=t.sent,r=n.data,r.data?e.tableList=[r.data]:e.tableList=[];case 5:case"end":return t.stop()}}),t)})))()},getMenusBind:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l["a"].getMenusBind({roleId:e.active,type:1});case 2:n=t.sent,r=n.data,e.showTree=!1,e.$nextTick((function(){r.data?e.MenusIds=r.data:e.MenusIds=[],e.showTree=!0}));case 6:case"end":return t.stop()}}),t)})))()},permission:function(e){this.$refs.permissionForm.init(this.active,e.id)},bindMenus:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l["a"].bindMenus({menuIds:[].concat(Object(s["a"])(e.$refs.tree.getCheckedKeys()),Object(s["a"])(e.$refs.tree.getHalfCheckedKeys())),roleId:e.active});case 2:if(n=t.sent,r=n.data,0==r.code){t.next=6;break}return t.abrupt("return",e.$message.error(r.msg));case 6:e.$message.success(r.msg),e.init(!0);case 8:case"end":return t.stop()}}),t)})))()},del:function(e){var t=this;this.$confirm("确认删除该菜单权限？","提示",{type:"danger",confirmButtonText:"确定",cancelButtonText:"取消"}).then(Object(i["a"])(regeneratorRuntime.mark((function n(){var r,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=[].concat(Object(s["a"])(t.$refs.tree.getCheckedKeys()),Object(s["a"])(t.$refs.tree.getHalfCheckedKeys())),r.splice(r.findIndex((function(t){return t==e.id})),1),n.next=4,l["a"].bindMenus({menuIds:r,roleId:t.active});case 4:if(a=n.sent,i=a.data,0==i.code){n.next=8;break}return n.abrupt("return",t.$message.error(i.msg));case 8:t.$message.success(i.msg),t.init(!0);case 10:case"end":return n.stop()}}),n)}))))}}},g=h,v=(n("ba4b"),n("2877")),y=Object(v["a"])(g,r,a,!1,null,"8abd80f6",null);t["default"]=y.exports},d4ec:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return r}))},dffc2:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{visible:e.visible,title:e.title,width:e.width},on:{"update:visible":function(t){e.visible=t},close:function(t){e.visible=!1}}},[n("el-form",{ref:"form",attrs:{"label-width":"120px",model:e.form,size:"medium",rules:e.rules,disabled:"view"===e.method},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit.apply(null,arguments)}}},[n("el-form-item",{attrs:{label:"角色名称：",prop:"name"}},[n("el-input",{attrs:{placeholder:"请输入"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),n("el-form-item",{attrs:{label:"排序",prop:"sort"}},[n("el-input-number",{attrs:{min:1,label:"排序"},model:{value:e.form.sort,callback:function(t){e.$set(e.form,"sort",t)},expression:"form.sort"}})],1),n("el-form-item",{attrs:{label:"状态：",prop:"useable"}},[n("el-radio-group",{model:{value:e.form.useable,callback:function(t){e.$set(e.form,"useable",t)},expression:"form.useable"}},[n("el-radio-button",{attrs:{label:"1"}},[e._v("正常")]),n("el-radio-button",{attrs:{label:"0"}},[e._v("停用")])],1)],1),n("el-form-item",{attrs:{label:"备注：",prop:"remarks"}},[n("el-input",{attrs:{type:"textarea"},model:{value:e.form.remarks,callback:function(t){e.$set(e.form,"remarks",t)},expression:"form.remarks"}})],1)],1),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取 消")]),n("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)],1)},a=[],s=n("1da1"),i=(n("96cf"),n("a9e3"),n("f477")),o=n("6632"),c=n("d4ec"),u=n("ade3"),l=function e(){Object(c["a"])(this,e),Object(u["a"])(this,"name",""),Object(u["a"])(this,"code",""),Object(u["a"])(this,"id",""),Object(u["a"])(this,"companyId",""),Object(u["a"])(this,"sort",10),Object(u["a"])(this,"type","2"),Object(u["a"])(this,"useable",1)},d={components:{},props:{width:{type:String,default:"50%"},companyId:{type:[Number,String],default:""}},watch:{},data:function(){return{visible:!1,method:"",form:new l,rules:{name:[{required:!0,message:"名称不能为空",trigger:"blur"}],type:[{required:!0,message:"类型不能为空",trigger:"blur"}]},id:"",title:"",dictUtils:i["a"],disabled:!1}},computed:{},methods:{init:function(e,t,n){var r=this;this.method=e,"add"===e?(this.form=new l,this.title="新建"):this.title="编辑",this.id=t,this.visible=!0,this.$nextTick(Object(s["a"])(regeneratorRuntime.mark((function n(){var a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("edit"!==e&&"view"!==e){n.next=9;break}return n.next=3,o["a"].getRoleByID({roleId:t});case 3:if(a=n.sent,s=a.data,0==s.code){n.next=8;break}return r.$message.error("获取数据失败"),n.abrupt("return");case 8:r.form=s.data;case 9:case"end":return n.stop()}}),n)}))))},submit:function(){var e=this;try{this.$refs.form.validate(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(n){var r,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n){t.next=14;break}return e.form.companyId=e.companyId,r=e.form,t.next=5,o["a"].saveRole(r);case 5:if(a=t.sent,s=a.data,0==s.code){t.next=9;break}return t.abrupt("return",e.$message.error(s.msg));case 9:e.$message.success(s.msg),e.$emit("update"),e.visible=!1,t.next=15;break;case 14:return t.abrupt("return",!1);case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}catch(t){this.$message.error(t)}}}},f=d,m=n("2877"),p=Object(m["a"])(f,r,a,!1,null,null,null);t["default"]=p.exports}}]);