(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-38ef27cc"],{"3ea2":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"user-manage"},[r("div",{staticClass:"page-header"},[r("el-form",{staticClass:"filter-form",attrs:{inline:!0,model:e.searchForm}},[r("el-form-item",[r("el-input",{attrs:{placeholder:"姓名",clearable:""},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.doSearch}},[e._v("查询")]),r("el-button",{attrs:{icon:"el-icon-refresh-right"},on:{click:e.resetParams}},[e._v("重置")])],1)],1),e.showUserCompanyTree&&!e.user.isSingleCompany?r("kr-tree-select",{attrs:{data:e.companyTree,props:e.treeProps,nodeKey:"id"},on:{getValue:e.changeCompany},model:{value:e.companyId,callback:function(t){e.companyId=t},expression:"companyId"}}):e._e()],1),r("div",{staticClass:"content"},[r("div",{staticClass:"table-box"},[r("kr-table",{ref:"table",attrs:{columns:e.columns,tableOptions:{"max-height":"100%"},fetchFunc:e.getUserList,searchParams:e.searchForm,selection:!1},on:{"selection-change":e.handleSelectionChange}})],1)]),r("listForm",{ref:"listForm",attrs:{companyId:e.companyId,treeData:e.organizationTreeData}})],1)},a=[],i=r("1da1"),s=r("5530"),c=(r("96cf"),r("b0c0"),r("4de4"),r("b15a")),o=r("2f62"),u=r("76bc"),l={name:"UserManage",components:{listForm:u["default"]},props:{},data:function(){this.$createElement;var e=this;return{filterText:"",selection:[],organizationTreeData:[],companyTree:[],companyId:0,current:"",showUserCompanyTree:!1,defaultProps:{children:"children",label:"name"},treeProps:{children:"children",label:"name",disabled:function(e,t){return!e.clickable}},searchForm:{name:"",nodeIds:""},columns:[{prop:"name",label:"人员姓名",render:function(t,r){return t("el-button",{attrs:{size:e.size,type:"text"},on:{click:function(){return e.view(r)}}},[r.name])}},{prop:"sex",sortable:!0,label:"性别",align:"left",render:function(e,t){return e("div",[" ",0==t.sex?"女":"男"])}},{prop:"createTime",align:"center",label:"创建时间",sortable:!0},{prop:"useable",label:"状态",align:"center",sortable:!0,render:function(t,r){return t("div",[t("el-switch",{attrs:{value:r.useable,"active-color":"#13ce66","inactive-color":"#ff4949","active-value":1,disabled:!0,"inactive-value":0},on:{change:function(){return e.changeUserState(r)}}}),t("span",{style:"color:#a6a7b8;margin-left:12px"},[1===r.useable?"正常":"已停用"])])}},{label:"操作",headerAlign:"center",width:240,align:"center",render:function(t,r){return t("div",[t("el-button",{on:{click:function(){return e.resetPassword(r)}},attrs:{icon:"krIconfont kr-tianxie",type:"text",size:e.size}},["密码重置"])])}}]}},computed:Object(s["a"])(Object(s["a"])({},Object(o["c"])({user:function(e){return e.user.user},size:function(e){return e.config.defaultSize}})),{},{getUserList:function(){return c["a"].list}}),watch:{filterText:function(e){this.$refs.tree.filter(e)}},filter:{},created:function(){this.searchForm.companyId=this.user.companyId},mounted:function(){this.companyId=this.user.companyId,this.init()},methods:Object(s["a"])(Object(s["a"])({},Object(o["b"])({updateUser:"user/updateUser"})),{},{init:function(){this.getOrgTree(),this.getUserClickTree()},getOrgTree:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c["a"].tree({companyId:String(e.companyId)});case 2:r=t.sent,n=r.data,e.organizationTreeData=[n.data],e.current=n.data;case 6:case"end":return t.stop()}}),t)})))()},getUserClickTree:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c["a"].userCompanyTree();case 2:r=t.sent,n=r.data,e.companyTree=[n.data],e.showUserCompanyTree=!0;case 6:case"end":return t.stop()}}),t)})))()},filterNode:function(e,t){return!e||-1!==t.name.indexOf(e)},organizationSelected:function(e){this.current=e,this.searchForm.nodeIds=e.nodeIds,this.doSearch()},handleSelectionChange:function(e){this.selection=e},changeCompany:function(e){this.companyId=e.id,this.searchForm.companyId=e.id,this.init(),this.$refs.table.init()},add:function(){this.$refs.listForm.init("add")},resetPassword:function(e){var t=this;this.$confirm("是否重置该用户密码？","重置密码",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,c["a"].reset({userId:String(e.id)});case 2:if(n=r.sent,a=n.data,0==a.code){r.next=6;break}return r.abrupt("return",t.$message.error(a.msg));case 6:t.$message.success(a.msg+",重置密码为:123456");case 7:case"end":return r.stop()}}),r)})))).catch((function(){}))},view:function(e){var t=this;this.$nextTick((function(){t.$refs.listForm.init("view",e.id,e)}))},changeUserState:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.useable=1===e.useable?0:1,r.next=3,c["a"].use({userId:String(e.id),useable:e.useable});case 3:if(n=r.sent,a=n.data,0==a.code){r.next=7;break}return r.abrupt("return",t.$message.error(a.msg));case 7:t.$refs.table.init(),t.$message.success(a.msg);case 9:case"end":return r.stop()}}),r)})))()},resetParams:function(){this.searchForm.name="",this.doSearch()},doSearch:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.table.insidePage=1,e.$refs.table.init();case 2:case"end":return t.stop()}}),t)})))()}})},d=l,m=(r("aa71"),r("2877")),h=Object(m["a"])(d,n,a,!1,null,"419cebcb",null);t["default"]=h.exports},"995c":function(e,t,r){},aa71:function(e,t,r){"use strict";r("995c")}}]);