(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-99e8db86","chunk-cb31aeba","chunk-0e6d02f2"],{"04b3":function(e,t,r){},3521:function(e,t,r){"use strict";var n=r("7bc1");t["a"]={bindMenu:function(e){return n["a"].post("/sys/bind/bindMenu",e)},list:function(e){return n["a"].post("/sys/bind/queryBindMenus",e)},bindRole:function(e){return n["a"].post("/sys/bind/userBindRoles",e)}}},6632:function(e,t,r){"use strict";r.d(t,"b",(function(){return a}));var n=r("7bc1"),a=function(e){return n["a"].post("/sys/role/list",e)},s=function(e){return n["a"].get("/sys/role/queryById",e)},i=function(e){return n["a"].post("/sys/role/saveRole",e)},o=function(e){return n["a"].post("/sys/role/delete",e)},c=function(e){return n["a"].get("/sys/role/useableList",e)},u=function(e){return n["a"].post("/sys/bind/queryBindRoles",e)};t["a"]={getRoleList:a,getRoleByID:s,saveRole:i,deleteRoleByID:o,useableList:c,userRoleList:u,use:function(e){return n["a"].get("/sys/role/enableRole",e)}}},6952:function(e,t,r){"use strict";r("04b3")},"70e5":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{visible:e.visible,title:"权限分配",width:e.width},on:{"update:visible":function(t){e.visible=t},close:function(t){e.visible=!1}}},[r("el-form",{ref:"form",attrs:{size:"medium"}},[r("el-row",[r("el-col",{attrs:{span:24}},[r("el-form-item",[r("kr-tree",{ref:"tree",staticClass:"tree",attrs:{data:e.treeData,props:e.treeProps,"node-key":e.nodeKey,"show-checkbox":"","default-expanded-keys":e.treeExpandData,"default-checked-keys":e.defaultKeys},on:{check:e.getChecked}})],1)],1)],1)],1),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取 消")]),r("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)],1)},a=[],s=r("2909"),i=r("1da1"),o=r("b85c"),c=(r("96cf"),r("a9e3"),r("99af"),r("3521")),u=r("eb40"),l=r("0208");function d(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=Object(o["a"])(e);try{for(i.s();!(r=i.n()).done;){var c=r.value;n.push(c[a]),s>=t||c.children&&c.children.length>0&&(s++,d(c.children,t,n,s))}}catch(u){i.e(u)}finally{i.f()}}var f={props:{width:{type:String,default:"30%"},nodeKey:{type:String,default:"id"},level:{type:Number,default:1},type:{type:String,default:"role"}},data:function(){return{visible:!1,id:"",authList:[],defaultKeys:[],treeData:[],treeProps:{children:"children",label:"name",disabled:"disabled"}}},mounted:function(){this.getAuthTree()},computed:{treeExpandData:function(){var e=[];return d(this.treeData,this.level,e,this.nodeKey),e}},methods:{init:function(e){var t=this;this.id=e,this.visible=!0,this.$nextTick(Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a,s,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.$refs.tree.$refs.tree.setCheckedKeys([]),n={},r.t0=t.type,r.next="role"===r.t0?5:"user"===r.t0?7:"post"===r.t0?9:"admin"===r.t0?11:13;break;case 5:return n.roleId=e,r.abrupt("break",14);case 7:return n.userId=e,r.abrupt("break",14);case 9:return n.postId=e,r.abrupt("break",14);case 11:return n.id=e,r.abrupt("break",14);case 13:return r.abrupt("break",14);case 14:if("admin"!=t.type){r.next=22;break}return r.next=17,u["a"].getMenus({id:e});case 17:a=r.sent,s=a.data,s.data.length>0&&(t.defaultKeys=s.data),r.next=27;break;case 22:return r.next=24,c["a"].list(n);case 24:i=r.sent,o=i.data,o.data.length>0&&(t.defaultKeys=o.data);case 27:case"end":return r.stop()}}),r)}))))},getAuthTree:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l["a"].getFilterMenu({flag:1});case 2:r=t.sent,n=r.data,e.treeData=n.data.children;case 5:case"end":return t.stop()}}),t)})))()},getChecked:function(e,t){this.authList=[].concat(Object(s["a"])(t.checkedKeys),Object(s["a"])(t.halfCheckedKeys))},submit:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,a,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:t.prev=0,r={menuIds:[].concat(Object(s["a"])(e.$refs.tree.getCheckedKeys()),Object(s["a"])(e.$refs.tree.getHalfCheckedKeys())),postId:null,roleId:null,userId:null},t.t0=e.type,t.next="role"===t.t0?5:"post"===t.t0?7:"user"===t.t0?9:11;break;case 5:return r.roleId=e.id,t.abrupt("break",12);case 7:return r.postId=e.id,t.abrupt("break",12);case 9:return r.userId=e.id,t.abrupt("break",12);case 11:return t.abrupt("break",12);case 12:if("admin"!=e.type){t.next=23;break}return t.next=15,u["a"].saveMenus({id:e.id,menuIds:[].concat(Object(s["a"])(e.$refs.tree.getCheckedKeys()),Object(s["a"])(e.$refs.tree.getHalfCheckedKeys()))});case 15:if(n=t.sent,a=n.data,0==a.code){t.next=19;break}return t.abrupt("return",e.$message.error(a.msg));case 19:e.$message.success(a.msg),e.visible=!1,t.next=31;break;case 23:return t.next=25,c["a"].bindMenu(r);case 25:if(i=t.sent,o=i.data,0==o.code){t.next=29;break}return t.abrupt("return",e.$message.error(o.msg));case 29:e.$message.success(o.msg),e.visible=!1;case 31:e.$emit("update"),t.next=37;break;case 34:t.prev=34,t.t1=t["catch"](0),e.$message.error(t.t1);case 37:case"end":return t.stop()}}),t,null,[[0,34]])})))()}}},m=f,p=r("2877"),h=Object(p["a"])(m,n,a,!1,null,null,null);t["default"]=h.exports},"7f2f":function(e,t,r){"use strict";r("ef8f")},"8f3b":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{visible:e.visible,title:"绑定角色",width:e.width},on:{"update:visible":function(t){e.visible=t},close:function(t){e.visible=!1}}},[r("el-form",{ref:"form",attrs:{size:"medium"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit.apply(null,arguments)}}},[r("el-form-item",[r("el-checkbox-group",{staticClass:"custom_check",model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},e._l(e.list,(function(t){return r("el-checkbox",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.name))])})),1)],1)],1),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)],1)},a=[],s=r("1da1"),i=r("5530"),o=(r("96cf"),r("a9e3"),r("f477")),c=r("6632"),u=r("3521"),l=r("2f62"),d={components:{},props:{width:{type:String,default:"50%"},companyId:{type:[String,Number],default:""}},watch:{},data:function(){return{visible:!1,method:"",rules:{},id:"",checkList:[],title:"",list:[],dictUtils:o["a"],disabled:!1}},computed:Object(i["a"])({},Object(l["c"])({user:function(e){return e.user.user}})),mounted:function(){},methods:{getList:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c["a"].useableList({companyId:String(e.companyId)});case 2:r=t.sent,n=r.data,e.list=n.data;case 5:case"end":return t.stop()}}),t)})))()},init:function(e){var t=this;this.id=e,this.visible=!0,this.checkList=[],this.$nextTick(Object(s["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.getList();case 2:return r.next=4,c["a"].userRoleList({companyId:String(t.companyId),userId:String(e)});case 4:n=r.sent,a=n.data,t.checkList=a.data;case 7:case"end":return r.stop()}}),r)}))))},submit:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,r={companyId:String(e.companyId),userId:String(e.id),roleIds:e.checkList},t.next=4,u["a"].bindRole(r);case 4:if(n=t.sent,a=n.data,0==a.code){t.next=8;break}return t.abrupt("return",e.$message.error(a.msg));case 8:e.$message.success(a.msg),e.visible=!1,t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](0),e.$message.error(t.t0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))()}}},f=d,m=(r("6952"),r("2877")),p=Object(m["a"])(f,n,a,!1,null,null,null);t["default"]=p.exports},c2a2:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"user-manage"},[r("div",{staticClass:"page-header"},[r("el-form",{staticClass:"filter-form",attrs:{inline:!0,model:e.searchForm}},[r("el-form-item",[r("el-input",{attrs:{placeholder:"姓名",clearable:""},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.doSearch}},[e._v("查询")]),r("el-button",{attrs:{icon:"el-icon-refresh-right"},on:{click:e.resetParams}},[e._v("重置")])],1)],1),e.showUserCompanyTree&&!e.user.isSingleCompany?r("kr-tree-select",{attrs:{data:e.companyTree,props:e.treeProps,nodeKey:"id"},on:{getValue:e.changeCompany},model:{value:e.companyId,callback:function(t){e.companyId=t},expression:"companyId"}}):e._e()],1),r("div",{staticClass:"content"},[r("div",{staticClass:"aside-box"},[r("div",{staticClass:"header"},[e._v("组织机构")]),r("div",{staticClass:"treeselect-box"},[r("el-input",{attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),r("div",{staticClass:"tree-box"},[r("kr-tree",{ref:"tree",staticClass:"tree",attrs:{data:e.organizationTreeData,props:e.defaultProps,"node-key":"id","default-expand-all":"","highlight-current":"","expand-on-click-node":!1,"filter-node-method":e.filterNode},on:{"node-click":e.organizationSelected}})],1)],1)]),r("div",{staticClass:"table-box"},[r("kr-table",{ref:"table",attrs:{columns:e.columns,tableOptions:{"max-height":"100%"},fetchFunc:e.getUserList,searchParams:e.searchForm,selection:!1},on:{"selection-change":e.handleSelectionChange}},[r("div",{attrs:{slot:"handleButtons"},slot:"handleButtons"},[r("span",{staticClass:"office_title"},[e._v(e._s(e.current.name))]),r("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.add()}}},[e._v("新增人员")])],1)])],1)]),r("listForm",{ref:"listForm",attrs:{companyId:e.companyId,treeData:e.organizationTreeData}}),r("authForm",{ref:"authForm",attrs:{type:"user"}}),r("roleForm",{ref:"roleForm",attrs:{companyId:e.companyId}})],1)},a=[],s=r("1da1"),i=r("5530"),o=(r("96cf"),r("b0c0"),r("4de4"),r("a434"),r("d81d"),r("b15a")),c=r("2f62"),u=r("4d45"),l=r("70e5"),d=r("8f3b"),f={name:"UserManage",components:{listForm:u["default"],authForm:l["default"],roleForm:d["default"]},props:{},data:function(){this.$createElement;var e=this;return{filterText:"",selection:[],organizationTreeData:[],companyTree:[],companyId:0,current:"",showUserCompanyTree:!1,defaultProps:{children:"children",label:"name"},treeProps:{children:"children",label:"name",disabled:function(e,t){return!e.clickable}},searchForm:{name:"",nodeIds:""},columns:[{prop:"name",label:"人员姓名",render:function(t,r){return t("el-button",{attrs:{size:e.size,type:"text"},on:{click:function(){return e.view(r)}}},[r.name])}},{prop:"sex",sortable:!0,label:"性别",render:function(e,t){return e("div",[" ",0==t.sex?"女":"男"])}},{prop:"phone",label:"联系电话"},{prop:"createTime",label:"创建时间",sortable:!0},{prop:"useable",label:"状态",sortable:!0,render:function(t,r){return t("div",[t("el-switch",{attrs:{value:r.useable,"active-color":"#13ce66","inactive-color":"#ff4949","active-value":1,"inactive-value":0},on:{change:function(){return e.changeUserState(r)}}}),t("span",{style:"color:#a6a7b8;margin-left:12px"},[1===r.useable?"正常":"已停用"])])}},{label:"操作",headerAlign:"center",width:240,align:"right",render:function(t,r){return t("div",[t("el-button",{on:{click:function(){return e.edit(r)}},attrs:{icon:"krIconfont kr-tianxie",type:"text",size:e.size}},["编辑"]),t("el-button",{on:{click:function(){return e.role(r)}},attrs:{icon:"krIconfont kr-hezuohuobanmiyueguanli",type:"text",size:e.size}},["角色"]),t("el-dropdown",{style:"margin-left: 10px",on:{command:function(t){return e.handleCommand(t,r)}}},[t("el-button",{attrs:{type:"text",size:e.size}},["下拉菜单",t("i",{class:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"openResetPasswordWindow"}},["密码重置"]),t("el-dropdown-item",{attrs:{command:"openPermissionWindow"}},["权限设置"]),t("el-dropdown-item",{attrs:{command:"deleteUser"}},["删除用户"])])])])}}]}},computed:Object(i["a"])(Object(i["a"])({},Object(c["c"])({user:function(e){return e.user.user},size:function(e){return e.config.defaultSize}})),{},{getUserList:function(){return o["a"].list}}),watch:{filterText:function(e){this.$refs.tree.filter(e)}},filter:{},created:function(){this.searchForm.companyId=this.user.companyId},mounted:function(){this.companyId=this.user.companyId,this.init()},methods:Object(i["a"])(Object(i["a"])({},Object(c["b"])({updateUser:"user/updateUser"})),{},{init:function(){this.getOrgTree(),this.getUserClickTree()},getOrgTree:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o["a"].tree({companyId:String(e.companyId)});case 2:r=t.sent,n=r.data,e.organizationTreeData=[n.data],e.current=n.data;case 6:case"end":return t.stop()}}),t)})))()},getUserClickTree:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o["a"].userCompanyTree();case 2:r=t.sent,n=r.data,e.companyTree=[n.data],e.showUserCompanyTree=!0;case 6:case"end":return t.stop()}}),t)})))()},filterNode:function(e,t){return!e||-1!==t.name.indexOf(e)},organizationSelected:function(e){this.current=e,this.searchForm.nodeIds=e.nodeIds,this.doSearch()},handleSelectionChange:function(e){this.selection=e},changeCompany:function(e){this.companyId=e.id,this.searchForm.companyId=e.id,this.init(),this.$refs.table.init()},add:function(){this.$refs.listForm.init("add")},edit:function(e){this.$refs.listForm.init("edit",e.id,e)},view:function(e){this.$refs.listForm.init("view",e.id,e)},changeUserState:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.useable=1===e.useable?0:1,r.next=3,o["a"].use({userId:String(e.id),useable:e.useable});case 3:if(n=r.sent,a=n.data,0==a.code){r.next=7;break}return r.abrupt("return",t.$message.error(a.msg));case 7:t.$refs.table.init(),t.$message.success(a.msg);case 9:case"end":return r.stop()}}),r)})))()},addOrgBtnClick:function(){this.formDialog.form.organizations.push({id:""})},deleteOrg:function(e){var t=this.formDialog.form.organizations.indexOf(e);-1!==t&&this.formDialog.form.organizations.splice(t,1)},saveUser:function(){var e=this.formDialog.form;e.id||this.rows.push(e),this.formDialog.visible=!1},addOrEdit:function(e){var t=this;e?(this.formDialog.form=Object(i["a"])({},e),this.formDialog.title="编辑人员"):this.formDialog.title="新增人员",this.formDialog.visible=!0,this.$nextTick((function(){t.$refs.form.clearValidate()}))},role:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.$refs.roleForm.init(e.id);case 1:case"end":return r.stop()}}),r)})))()},handleCommand:function(e,t){var r=this;"openResetPasswordWindow"===e?this.$confirm("是否重置该用户密码？","重置密码",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function e(){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o["a"].reset({userId:String(t.id)});case 2:if(n=e.sent,a=n.data,0==a.code){e.next=6;break}return e.abrupt("return",r.$message.error(a.msg));case 6:r.$message.success(a.msg+",重置密码为:Aa12345678");case 7:case"end":return e.stop()}}),e)})))).catch((function(){})):"openPermissionWindow"===e?this.$refs.authForm.init(t.id):"deleteUser"===e&&this.del(t)},del:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e instanceof Array||(e=[e]),0!=e.length){r.next=3;break}return r.abrupt("return",t.$message.error("请选择需要删除的项!"));case 3:t.$confirm("此操作将永久删除所选, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function r(){var n,a,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.map((function(e){return e.id})),r.next=3,o["a"].del({ids:n});case 3:if(a=r.sent,s=a.data,0==s.code){r.next=7;break}return r.abrupt("return",t.$message.error(s.msg));case 7:t.$message.success(s.msg),t.$refs.table.init();case 9:case"end":return r.stop()}}),r)})))).catch((function(){t.$message({type:"info",message:"已取消删除"})}));case 4:case"end":return r.stop()}}),r)})))()},resetParams:function(){this.searchForm.name="",this.doSearch()},doSearch:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.table.insidePage=1,e.$refs.table.init();case 2:case"end":return t.stop()}}),t)})))()}})},m=f,p=(r("7f2f"),r("2877")),h=Object(p["a"])(m,n,a,!1,null,"8e863ada",null);t["default"]=h.exports},eb40:function(e,t,r){"use strict";var n=r("7bc1");t["a"]={save:function(e){return n["a"].post("/sys/roleAdmin/save",e)},detail:function(e){return n["a"].get("/sys/roleAdmin/queryById",e)},getMenus:function(e){return n["a"].get("/sys/roleAdmin/queryBindMenus",e)},list:function(e){return n["a"].post("/sys/roleAdmin/list",e)},del:function(e){return n["a"].get("/sys/roleAdmin/delete",e)},saveMenus:function(e){return n["a"].post("/sys/roleAdmin/bindMenu",e)}}},ef8f:function(e,t,r){}}]);